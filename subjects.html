<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§‘ç›®å­¦ä¹  - è®¡ç®—æœºè€ƒç ”å­¦ä¹ å¹³å°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- æ·»åŠ CryptoJSåº“æ”¯æŒ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="assets/css/common.css" rel="stylesheet">
    <!-- AIåŠ©æ‰‹åŠ è½½å™¨ -->
    <script src="assets/js/ai-assistant-loader.js"></script>
    <!-- èµ„æºåŠ è½½å™¨å’Œæ•°æ®æ–‡ä»¶ -->
    <script src="assets/js/course-data.js"></script>
    <script src="assets/js/fallback-data.js"></script>
    <script src="assets/js/resource-loader.js"></script>
    <!-- ç¬”è®°ç®¡ç†ç³»ç»Ÿ -->
    <script src="assets/js/notes-manager.js"></script>
    <!-- å­¦ä¹ ç»Ÿè®¡ç®¡ç†å™¨ -->
    <script src="assets/js/stats-manager.js"></script>
    <style>
        .hero-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .card-hover:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .progress-bar {
            background: linear-gradient(90deg, #10b981 0%, #34d399 100%);
        }

        .chapter-item:hover {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
        }

        [x-cloak] {
            display: none !important;
        }

        .prose h1,
        .prose h2,
        .prose h3 {
            color: #1f2937;
            font-weight: 600;
        }

        .prose pre {
            background: #f3f4f6;
            border-radius: 0.5rem;
            padding: 1rem;
        }

        .prose code {
            background: #f3f4f6;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.875rem;
        }

        /* å¯è°ƒèŠ‚çª—å£æ ·å¼ */
        .resize-container {
            transition: all 0.3s ease;
            min-width: 600px;
            min-height: 400px;
        }

        .resize-container:hover {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
    </style>
</head>

<body class="bg-gray-50" x-data="subjectApp()">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-2">
                    <a href="index.html" class="flex items-center space-x-2">
                        <i class="fas fa-graduation-cap text-2xl text-indigo-600"></i>
                        <h1 class="text-xl font-bold text-gray-800">è®¡ç®—æœºè€ƒç ”å¹³å°</h1>
                    </a>
                </div>
                <div class="hidden md:flex space-x-6">
                    <a href="index.html" class="text-gray-600 hover:text-indigo-600 transition">é¦–é¡µ</a>
                    <a href="#" class="text-indigo-600 font-semibold">è¯¾ç¨‹å¯¼èˆª</a>
                    <a href="practice.html" class="text-gray-600 hover:text-indigo-600 transition">çœŸé¢˜ç»ƒä¹ </a>
                    <a href="resources.html" class="text-gray-600 hover:text-indigo-600 transition">å­¦ä¹ èµ„æº</a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="hidden md:block text-sm text-gray-600">
                        å­¦ä¹ è¿›åº¦: <span class="text-indigo-600 font-semibold" x-text="overallProgress + '%'"></span>
                    </div>
                    <button class="md:hidden text-gray-600 hover:text-indigo-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- é¢åŒ…å±‘å¯¼èˆª -->
    <div class="bg-white border-b">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2 text-sm">
                    <a href="index.html" class="text-indigo-600 hover:text-indigo-800">é¦–é¡µ</a>
                    <i class="fas fa-chevron-right text-gray-400"></i>
                    <span class="text-gray-600" x-text="currentSubjectType === 'public' ? 'å…¬å…±è¯¾' : 'ä¸“ä¸šè¯¾'"></span>
                </div>
                <!-- è°ƒè¯•ä¿¡æ¯ -->
                <div class="text-xs text-gray-500">
                    è°ƒè¯•: <span x-text="currentSubjects.length"></span> é—¨è¯¾ç¨‹å·²åŠ è½½
                    <button @click="console.log('å½“å‰ç§‘ç›®æ•°æ®:', currentSubjects)"
                        class="ml-2 text-blue-500 hover:text-blue-700">
                        æŸ¥çœ‹æ•°æ®
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- å¤´éƒ¨åŒºåŸŸ -->
    <section class="hero-bg text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-3xl md:text-4xl font-bold mb-4">
                    <span x-show="currentSubjectType === 'public'">ğŸ“š å…¬å…±è¯¾å­¦ä¹ </span>
                    <span x-show="currentSubjectType === 'professional'">ğŸ’» ä¸“ä¸šè¯¾å­¦ä¹ </span>
                </h2>
                <p class="text-lg opacity-90 mb-6"
                    x-text="currentSubjectType === 'public' ? 'æ•°å­¦ã€æ”¿æ²»ã€è‹±è¯­ - å¥ å®šè€ƒç ”åŸºç¡€' : 'è®¡ç®—æœºæ ¸å¿ƒç§‘ç›® - ä¸“ä¸šèƒ½åŠ›æå‡'"></p>
            </div>
            
            <!-- å­¦ä¹ è¿›åº¦ç»Ÿè®¡ -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
                <div class="text-center">
                    <div class="text-2xl font-bold" x-text="totalChapters"></div>
                    <div class="text-sm opacity-75">æ€»ç« èŠ‚</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" x-text="completedChapters"></div>
                    <div class="text-sm opacity-75">å·²å®Œæˆ</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" x-text="overallProgress + '%'"></div>
                    <div class="text-sm opacity-75">å®Œæˆåº¦</div>
                </div>
                <div class="text-center">
                    <div class="text-2xl font-bold" x-text="formatTime(getTodayStudyTime())"></div>
                    <div class="text-sm opacity-75">ä»Šæ—¥å­¦ä¹ </div>
                </div>
            </div>

            <!-- ä»Šæ—¥å­¦ä¹ ç›®æ ‡è¿›åº¦é¢æ¿ -->
            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center">
                    <i class="fas fa-bullseye mr-2"></i>
                    ä»Šæ—¥å­¦ä¹ ç›®æ ‡
                </h3>
                
                <!-- æ— æ•°æ®æ—¶çš„æç¤º -->
                <div x-show="getTodayStudyTime() === 0 && getTodayQuestions() === 0">
                    <div class="text-center py-8">
                        <i class="fas fa-rocket text-4xl text-white/50 mb-4"></i>
                        <p class="text-white/80 mb-4">å¼€å§‹å­¦ä¹ åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºæ‚¨çš„è¿›åº¦</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div class="bg-white/10 rounded-lg p-3 text-center">
                                <i class="fas fa-play-circle text-xl mb-2"></i>
                                <div>è§‚çœ‹è§†é¢‘è¯¾ç¨‹</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3 text-center">
                                <i class="fas fa-edit text-xl mb-2"></i>
                                <div>å®Œæˆç»ƒä¹ é¢˜</div>
                            </div>
                            <div class="bg-white/10 rounded-lg p-3 text-center">
                                <i class="fas fa-chart-line text-xl mb-2"></i>
                                <div>è¿½è¸ªè¿›åº¦</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- æœ‰æ•°æ®æ—¶æ˜¾ç¤ºè¿›åº¦ -->
                <div x-show="getTodayStudyTime() > 0 || getTodayQuestions() > 0">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- å­¦ä¹ æ—¶é•¿ç›®æ ‡ -->
                        <div class="text-center">
                            <div class="mb-2">
                                <div class="text-2xl font-bold" x-text="formatTime(getTodayStudyTime())"></div>
                                <div class="text-sm opacity-75" x-text="'/ ' + formatTime(getDailyGoal())"></div>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3 mb-2">
                                <div class="bg-white rounded-full h-3 transition-all duration-500" 
                                     :style="`width: ${Math.min(100, Math.round((getTodayStudyTime() / getDailyGoal()) * 100))}%`"></div>
                            </div>
                            <div class="text-xs opacity-90">
                                å­¦ä¹ æ—¶é•¿ (<span x-text="Math.min(100, Math.round((getTodayStudyTime() / getDailyGoal()) * 100))"></span>%)
                            </div>
                        </div>

                        <!-- ç­”é¢˜æ•°é‡ç›®æ ‡ -->
                        <div class="text-center">
                            <div class="mb-2">
                                <div class="text-2xl font-bold" x-text="getTodayQuestions()"></div>
                                <div class="text-sm opacity-75" x-text="'/ ' + getDailyQuestionsGoal() + ' é¢˜'"></div>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3 mb-2">
                                <div class="bg-yellow-300 rounded-full h-3 transition-all duration-500" 
                                     :style="`width: ${Math.min(100, Math.round((getTodayQuestions() / getDailyQuestionsGoal()) * 100))}%`"></div>
                            </div>
                            <div class="text-xs opacity-90">
                                ç­”é¢˜æ•°é‡ (<span x-text="Math.min(100, Math.round((getTodayQuestions() / getDailyQuestionsGoal()) * 100))"></span>%)
                            </div>
                        </div>

                        <!-- æ­£ç¡®ç‡ç›®æ ‡ -->
                        <div class="text-center">
                            <div class="mb-2">
                                <div class="text-2xl font-bold" x-text="getTodayAccuracy() + '%'"></div>
                                <div class="text-sm opacity-75" x-text="'/ ' + getAccuracyGoal() + '%'"></div>
                            </div>
                            <div class="w-full bg-white/20 rounded-full h-3 mb-2">
                                <div class="rounded-full h-3 transition-all duration-500"
                                     :class="getTodayAccuracy() >= getAccuracyGoal() ? 'bg-green-400' : 'bg-orange-400'"
                                     :style="`width: ${Math.min(100, Math.round((getTodayAccuracy() / getAccuracyGoal()) * 100))}%`"></div>
                            </div>
                            <div class="text-xs opacity-90">
                                æ­£ç¡®ç‡ (<span x-text="getTodayAccuracy() >= getAccuracyGoal() ? 'å·²è¾¾æˆ' : 'åŠªåŠ›ä¸­'"></span>)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç›®æ ‡å®Œæˆæç¤º -->
                <div class="mt-4 p-3 rounded-lg bg-white/10 border border-white/20">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <i class="fas fa-flag mr-2" 
                               :class="getTodayStudyTime() > 0 || getTodayQuestions() > 0 ? (getDailyGoalCompletionCount().completed === 3 ? 'text-green-300' : 'text-blue-300') : 'text-blue-300'"></i>
                            <span class="text-sm font-medium" 
                                  x-text="getTodayStudyTime() > 0 || getTodayQuestions() > 0 ? getDailyGoalCompletionCount().message : 'ğŸ¯ è®¾ç½®å­¦ä¹ ç›®æ ‡ï¼Œå¼€å§‹è¿½è¸ªè¿›åº¦'"></span>
                        </div>
                        <button @click="openStatsModal()" 
                                class="text-xs text-white/80 hover:text-white underline">
                            æŸ¥çœ‹ç»Ÿè®¡è¯¦æƒ…
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç§‘ç›®åˆ—è¡¨ -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid lg:grid-cols-3 gap-8">
                <!-- ç§‘ç›®å¡ç‰‡ -->
                <template x-for="subject in currentSubjects" :key="subject.id">
                    <div class="bg-white rounded-xl shadow-lg overflow-hidden card-hover">
                        <!-- ç§‘ç›®å¤´éƒ¨ -->
                        <div class="p-6 bg-gradient-to-r" :class="subject.bgColor">
                            <div class="flex items-center justify-between text-white">
                                <div class="flex items-center space-x-3">
                                    <i :class="subject.icon" class="text-2xl"></i>
                                    <div>
                                        <h3 class="text-xl font-bold" x-text="subject.name"></h3>
                                        <p class="opacity-90 text-sm" x-text="subject.description"></p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-lg font-bold" x-text="subject.progress + '%'"></div>
                                    <div class="text-xs opacity-75">å®Œæˆåº¦</div>
                                </div>
                            </div>
                            <!-- è¿›åº¦æ¡ -->
                            <div class="mt-4">
                                <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                                    <div class="progress-bar h-2 rounded-full transition-all duration-500"
                                        :style="`width: ${subject.progress}%`"></div>
                                </div>
                            </div>
                        </div>

                        <!-- ç« èŠ‚åˆ—è¡¨ -->
                        <div class="p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-semibold text-gray-800">å­¦ä¹ ç« èŠ‚</h4>
                                <span class="text-sm text-gray-500"
                                    x-text="`${subject.completedChapters}/${subject.chapters.length}`"></span>
                            </div>
                            <div class="space-y-2 max-h-64 overflow-y-auto">
                                <template x-for="(chapter, index) in subject.chapters" :key="index">
                                    <div class="chapter-item p-3 rounded-lg border transition-all duration-200"
                                        :class="chapter.completed ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'">

                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <i class="cursor-pointer"
                                                    :class="chapter.completed ? 'fas fa-check-circle text-green-500' : 'far fa-circle text-gray-400'"
                                                    @click.stop="toggleChapter(subject.id, index)">
                                                </i>

                                                <div>
                                                    <div class="font-medium text-sm flex items-center">
                                                        <span x-text="chapter.name"></span>
                                                        <span x-show="chapter.url || chapter.bv"
                                                            class="ml-2 text-blue-500">
                                                            <i class="fas fa-play-circle cursor-pointer text-blue-500"
                                                                @click.stop="goToChapterPlayer(subject.id, index, chapter)"></i>

                                                        </span>


                                                    </div>
                                                    <div class="text-xs text-gray-500" x-text="chapter.duration"></div>
                                                </div>
                                            </div>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-xs px-2 py-1 rounded"
                                                    :class="getDifficultyColor(chapter.difficulty)"
                                                    x-text="chapter.difficulty"></span>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                            </div>
                            <!-- æ“ä½œæŒ‰é’® -->
                            <div class="mt-6 flex space-x-3">
                                <button
                                    class="flex-1 bg-indigo-500 text-white py-2 px-4 rounded-lg hover:bg-indigo-600 transition text-sm font-medium"
                                    @click="startStudy(subject.id)">
                                    <i class="fas fa-play mr-2"></i>å¼€å§‹å­¦ä¹ 
                                </button>
                                <button
                                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition text-sm"
                                    @click="showNotes(subject.id)">
                                    <i class="fas fa-sticky-note"></i>
                                </button>
                                <button
                                    class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition text-sm"
                                    @click="showStats(subject.id)">
                                    <i class="fas fa-chart-bar"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </section>

    <!-- å­¦ä¹ å»ºè®®åŒºåŸŸ -->
    <section class="bg-gradient-to-r from-indigo-50 to-purple-50 py-16">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center mb-8">
                <div class="text-center flex-1">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">ğŸ’¡ å­¦ä¹ å»ºè®®</h3>
                    <p class="text-gray-600">æ ¹æ®æ‚¨çš„å­¦ä¹ è¿›åº¦ï¼Œä¸ºæ‚¨æ¨èæœ€ä½³å­¦ä¹ è·¯å¾„</p>
                </div>
                <button @click="refreshSuggestions()"
                    class="ml-6 bg-white text-indigo-600 px-4 py-2 rounded-lg shadow hover:shadow-md transition-all duration-200 flex items-center space-x-2">
                    <i class="fas fa-sync-alt"></i>
                    <span>æ¢ä¸€æ¢</span>
                </button>
            </div>

            <!-- å»ºè®®å¡ç‰‡å®¹å™¨ -->
            <div class="relative overflow-hidden">
                <!-- æ»‘åŠ¨å®¹å™¨ -->
                <div class="flex transition-transform duration-500 ease-in-out" :style="`transform: translateX(0)`">
                    <template x-for="(suggestion, index) in currentSuggestions" :key="`${suggestion.type}-${index}`">
                        <div class="w-full md:w-1/3 flex-shrink-0 px-3">
                            <div class="bg-white p-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1"
                                @click="applySuggestion(suggestion)">
                                <div class="flex items-center mb-4">
                                    <i :class="`${suggestion.icon} text-${suggestion.color} text-xl mr-3`"></i>
                                    <h4 class="font-semibold text-gray-800" x-text="suggestion.title"></h4>
                                </div>
                                <p class="text-gray-600 text-sm mb-3" x-text="suggestion.content"></p>
                                <div class="flex items-center justify-between">
                                    <span class="text-xs text-gray-500" x-text="suggestion.detail"></span>
                                    <i class="fas fa-arrow-right text-gray-400 text-sm"></i>
                                </div>

                                <!-- å»ºè®®ç±»å‹æ ‡è¯† -->
                                <div class="mt-3 pt-3 border-t border-gray-100">
                                    <span class="inline-block px-2 py-1 text-xs rounded-full" :class="{
                                              'bg-yellow-100 text-yellow-700': suggestion.type === 'today',
                                              'bg-red-100 text-red-700': suggestion.type === 'weak',
                                              'bg-green-100 text-green-700': suggestion.type === 'achievement',
                                              'bg-blue-100 text-blue-700': suggestion.type === 'motivation',
                                              'bg-purple-100 text-purple-700': suggestion.type === 'schedule',
                                              'bg-orange-100 text-orange-700': suggestion.type === 'review',
                                              'bg-indigo-100 text-indigo-700': suggestion.type === 'practice',
                                              'bg-gray-100 text-gray-700': !['today', 'weak', 'achievement', 'motivation', 'schedule', 'review', 'practice'].includes(suggestion.type)
                                          }" x-text="getSuggestionTypeText(suggestion.type)">
                                    </span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- æ»‘åŠ¨æŒ‡ç¤ºå™¨ -->
            <div class="flex justify-center mt-6 space-x-2" x-show="studySuggestions.length > maxVisibleSuggestions">
                <template x-for="(dot, index) in Math.ceil(studySuggestions.length / maxVisibleSuggestions)"
                    :key="index">
                    <button @click="currentSuggestionIndex = index * maxVisibleSuggestions"
                        class="w-2 h-2 rounded-full transition-all duration-200"
                        :class="Math.floor(currentSuggestionIndex / maxVisibleSuggestions) === index ? 'bg-indigo-600' : 'bg-gray-300'">
                    </button>
                </template>
            </div>

            <!-- å­¦ä¹ ç»Ÿè®¡æ¦‚è§ˆ -->
            <div class="mt-8 bg-white rounded-lg shadow-sm p-6">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                    <div>
                        <div class="text-2xl font-bold text-indigo-600" x-text="totalChapters"></div>
                        <div class="text-sm text-gray-600">æ€»ç« èŠ‚æ•°</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-green-600" x-text="completedChapters"></div>
                        <div class="text-sm text-gray-600">å·²å®Œæˆ</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-orange-600" x-text="overallProgress + '%'"></div>
                        <div class="text-sm text-gray-600">æ€»è¿›åº¦</div>
                    </div>
                    <div>
                        <div class="text-2xl font-bold text-purple-600" x-text="getStreakDays()"></div>
                        <div class="text-sm text-gray-600">è¿ç»­å¤©æ•°</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç¬”è®°ç®¡ç†å¼¹çª— -->
    <div x-show="showNotesModal" x-cloak
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
        @click.self="showNotesModal = false">
        <div class="bg-white rounded-xl w-full overflow-hidden flex flex-col resize-container"
            :style="`width: ${modalWidth}px; height: ${modalHeight}px; max-width: 95vw; max-height: 95vh;`">
            <!-- å¤´éƒ¨ -->
            <div class="flex justify-between items-center p-6 border-b bg-gray-50">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-sticky-note text-indigo-600 text-xl"></i>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">å­¦ä¹ ç¬”è®°</h3>
                        <p class="text-sm text-gray-600" x-text="currentNoteSubject?.name || 'å…¨éƒ¨ç¬”è®°'"></p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <!-- çª—å£å°ºå¯¸æ§åˆ¶ -->
                    <div class="flex items-center space-x-2 text-sm text-gray-500">
                        <button @click="resizeModal('small')"
                            :class="modalSize === 'small' ? 'text-indigo-600' : 'text-gray-400'"
                            class="hover:text-indigo-600" title="å°çª—å£">
                            <i class="fas fa-compress-alt"></i>
                        </button>
                        <button @click="resizeModal('medium')"
                            :class="modalSize === 'medium' ? 'text-indigo-600' : 'text-gray-400'"
                            class="hover:text-indigo-600" title="ä¸­ç­‰çª—å£">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                        <button @click="resizeModal('large')"
                            :class="modalSize === 'large' ? 'text-indigo-600' : 'text-gray-400'"
                            class="hover:text-indigo-600" title="å¤§çª—å£">
                            <i class="fas fa-expand-alt"></i>
                        </button>
                    </div>

                    <!-- æœç´¢æ¡† -->
                    <div class="relative">
                        <input type="text" x-model="noteSearchQuery" @input="searchNotes()" placeholder="æœç´¢ç¬”è®°..."
                            class="pl-10 pr-4 py-2 border rounded-lg text-sm w-64 focus:border-indigo-500 focus:outline-none">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400 text-sm"></i>
                    </div>
                    <button @click="showNotesModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="flex flex-1 overflow-hidden">
                <!-- å·¦ä¾§ï¼šç¬”è®°åˆ—è¡¨ -->
                <div class="w-1/3 border-r bg-gray-50 overflow-y-auto">
                    <!-- ç­›é€‰å™¨ -->
                    <div class="p-4 border-b bg-white">
                        <div class="space-y-3">
                            <!-- ç§‘ç›®ç­›é€‰ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ç§‘ç›®</label>
                                <select x-model="noteFilterSubject" @change="filterNotes()"
                                    class="w-full p-2 border rounded text-sm">
                                    <option value="">å…¨éƒ¨ç§‘ç›®</option>
                                    <template x-for="subject in allSubjects" :key="subject.id">
                                        <option :value="subject.id" x-text="subject.name"></option>
                                    </template>
                                </select>
                            </div>

                            <!-- æ ‡ç­¾ç­›é€‰ -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">æ ‡ç­¾</label>
                                <div class="flex flex-wrap gap-1">
                                    <template x-for="tag in allNoteTags" :key="tag">
                                        <button @click="toggleTagFilter(tag)" :class="selectedTagFilters.includes(tag) ? 
                                                       'bg-indigo-100 text-indigo-800' : 'bg-gray-100 text-gray-600'"
                                            class="px-2 py-1 rounded text-xs hover:bg-indigo-50">
                                            #<span x-text="tag"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>

                            <!-- æ–°å»ºç¬”è®°æŒ‰é’® -->
                            <button @click="createNewNote()"
                                class="w-full bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition text-sm font-medium">
                                <i class="fas fa-plus mr-2"></i>æ–°å»ºç¬”è®°
                            </button>
                        </div>
                    </div>

                    <!-- ç¬”è®°åˆ—è¡¨ -->
                    <div class="p-4">
                        <template x-for="note in filteredNotes" :key="note.id">
                            <div @click="selectNote(note)" :class="selectedNote?.id === note.id ? 
                                         'bg-indigo-50 border-indigo-200' : 'bg-white border-gray-200'"
                                class="p-4 border rounded-lg mb-3 cursor-pointer hover:bg-gray-50 transition">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-medium text-gray-800 text-sm" x-text="note.title"></h4>
                                    <div class="flex items-center space-x-1">
                                        <button @click.stop="deleteNote(note.id)"
                                            class="text-gray-400 hover:text-red-600 text-xs">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="text-xs text-gray-500 mb-2"
                                    x-text="note.subjectName + ' â€¢ ' + note.chapterName"></div>

                                <div class="text-xs text-gray-600 mb-2"
                                    x-text="note.content.substring(0, 80) + (note.content.length > 80 ? '...' : '')">
                                </div>

                                <!-- æ ‡ç­¾ -->
                                <div class="flex flex-wrap gap-1 mb-2">
                                    <template x-for="tag in note.tags" :key="tag">
                                        <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
                                            #<span x-text="tag"></span>
                                        </span>
                                    </template>
                                </div>

                                <div class="text-xs text-gray-400" x-text="formatNoteDate(note.updatedAt)"></div>
                            </div>
                        </template>

                        <div x-show="filteredNotes.length === 0" class="text-center text-gray-500 py-8">
                            <i class="fas fa-sticky-note text-3xl mb-3 opacity-50"></i>
                            <p>æš‚æ— ç¬”è®°</p>
                        </div>
                    </div>
                </div>

                <!-- å³ä¾§ï¼šç¬”è®°ç¼–è¾‘å™¨ -->
                <div class="flex-1 flex flex-col">
                    <div x-show="selectedNote" class="flex-1 flex flex-col">
                        <!-- ç¬”è®°å¤´éƒ¨ -->
                        <div class="p-4 border-b bg-gray-50">
                            <div class="flex justify-between items-center mb-3">
                                <input type="text" x-model="selectedNote.title" @input="updateSelectedNote()"
                                    placeholder="ç¬”è®°æ ‡é¢˜..."
                                    class="text-lg font-semibold bg-transparent border-none focus:outline-none flex-1">
                                <div class="flex items-center space-x-2">
                                    <button @click="exportSelectedNote()" class="text-gray-500 hover:text-indigo-600">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- å…ƒä¿¡æ¯ -->
                            <div class="flex items-center space-x-4 text-sm">
                                <select x-model="selectedNote.subjectId" @change="updateSelectedNote()"
                                    class="border rounded px-2 py-1 text-sm">
                                    <template x-for="subject in allSubjects" :key="subject.id">
                                        <option :value="subject.id" x-text="subject.name"></option>
                                    </template>
                                </select>

                                <select x-model="selectedNote.chapterId" @change="updateSelectedNote()"
                                    class="border rounded px-2 py-1 text-sm">
                                    <option value="">é€‰æ‹©ç« èŠ‚</option>
                                   <template x-for="(chapter, idx) in getChaptersBySubject(selectedNote.subjectId)" :key="idx">
                                         <option :value="chapter.name" x-text="chapter.name"></option>
                                   </template>

                                </select>

                                <span class="text-gray-500"
                                    x-text="'æœ€åç¼–è¾‘: ' + formatNoteDate(selectedNote.updatedAt)"></span>
                            </div>

                            <!-- æ ‡ç­¾ç¼–è¾‘ -->
                            <div class="mt-3">
                                <div class="flex items-center space-x-2">
                                    <span class="text-sm text-gray-600">æ ‡ç­¾:</span>
                                    <div class="flex flex-wrap gap-1 flex-1">
                                        <template x-for="tag in selectedNote.tags" :key="tag">
                                            <span
                                                class="bg-indigo-100 text-indigo-800 px-2 py-1 rounded text-xs flex items-center">
                                                #<span x-text="tag"></span>
                                                <button @click="removeNoteTag(tag)"
                                                    class="ml-1 text-indigo-600 hover:text-indigo-800">
                                                    <i class="fas fa-times text-xs"></i>
                                                </button>
                                            </span>
                                        </template>
                                        <input type="text" x-model="newNoteTag" @keydown.enter="addNoteTag()"
                                            placeholder="æ·»åŠ æ ‡ç­¾..."
                                            class="border-none bg-transparent text-sm focus:outline-none min-w-0 flex-1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ç¼–è¾‘å™¨å·¥å…·æ  -->
                        <div class="p-3 border-b bg-white">
                            <div class="flex items-center space-x-3 text-sm">
                                <button @click="insertMarkdown('**', '**')" class="text-gray-600 hover:text-indigo-600"
                                    title="ç²—ä½“">
                                    <i class="fas fa-bold"></i>
                                </button>
                                <button @click="insertMarkdown('*', '*')" class="text-gray-600 hover:text-indigo-600"
                                    title="æ–œä½“">
                                    <i class="fas fa-italic"></i>
                                </button>
                                <button @click="insertMarkdown('`', '`')" class="text-gray-600 hover:text-indigo-600"
                                    title="ä»£ç ">
                                    <i class="fas fa-code"></i>
                                </button>
                                <span class="text-gray-300">|</span>
                                <button @click="insertMarkdown('## ', '')" class="text-gray-600 hover:text-indigo-600"
                                    title="æ ‡é¢˜">
                                    <i class="fas fa-heading"></i>
                                </button>
                                <button @click="insertMarkdown('- ', '')" class="text-gray-600 hover:text-indigo-600"
                                    title="åˆ—è¡¨">
                                    <i class="fas fa-list"></i>
                                </button>
                                <button @click="insertMarkdown('[é“¾æ¥æ–‡å­—](URL)', '')"
                                    class="text-gray-600 hover:text-indigo-600" title="é“¾æ¥">
                                    <i class="fas fa-link"></i>
                                </button>
                                <span class="text-gray-300">|</span>
                                <button @click="togglePreview()"
                                    :class="showPreview ? 'text-indigo-600' : 'text-gray-600'"
                                    class="hover:text-indigo-600" title="é¢„è§ˆ">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <!-- å†…å®¹ç¼–è¾‘åŒº -->
                        <div class="flex-1 flex">
                            <!-- Markdown ç¼–è¾‘å™¨ -->
                            <div :class="showPreview ? 'w-1/2' : 'w-full'" class="border-r">
                                <textarea x-model="selectedNote.content" @input="updateSelectedNote()"
                                    x-ref="noteTextarea" placeholder="åœ¨è¿™é‡Œå¼€å§‹å†™ä½ çš„å­¦ä¹ ç¬”è®°...

æ”¯æŒ Markdown è¯­æ³•:
# ä¸€çº§æ ‡é¢˜
## äºŒçº§æ ‡é¢˜
**ç²—ä½“** *æ–œä½“*
- åˆ—è¡¨é¡¹
```
ä»£ç å—
```
[é“¾æ¥](URL)" class="w-full h-full p-4 border-none resize-none focus:outline-none font-mono text-sm leading-relaxed"></textarea>
                            </div>

                            <!-- é¢„è§ˆåŒº -->
                            <div x-show="showPreview" class="w-1/2 p-4 bg-gray-50 overflow-y-auto">
                                <div class="prose prose-sm max-w-none" x-html="renderMarkdown(selectedNote.content)">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ç©ºçŠ¶æ€ -->
                    <div x-show="!selectedNote" class="flex-1 flex items-center justify-center">
                        <div class="text-center text-gray-500">
                            <i class="fas fa-sticky-note text-6xl mb-4 opacity-30"></i>
                            <h3 class="text-lg font-medium mb-2">é€‰æ‹©ä¸€ä¸ªç¬”è®°å¼€å§‹ç¼–è¾‘</h3>
                            <p class="text-sm">æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°çš„å­¦ä¹ ç¬”è®°</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-300">&copy; 2026 è®¡ç®—æœºè€ƒç ”å­¦ä¹ å¹³å°. ä¸“æ³¨é«˜æ•ˆå­¦ä¹ ä½“éªŒ.Copyright belongs to Ouyang Ziheng</p>
        </div>
    </footer>

    <script>
        const PROGRESS_KEY = "chapterProgress";

        // ä¿å­˜æŸç« èŠ‚çš„å­¦ä¹ è¿›åº¦
        function saveProgress(courseId, chapterIndex, progressData) {
            const all = JSON.parse(localStorage.getItem(PROGRESS_KEY) || "{}");
            if (!all[courseId]) all[courseId] = {};

            all[courseId][chapterIndex] = {
                ...all[courseId][chapterIndex],
                ...progressData,
                lastVisited: new Date().toISOString()
            };

            localStorage.setItem(PROGRESS_KEY, JSON.stringify(all));
        }

        // åŠ è½½æŸè¯¾ç¨‹çš„æ‰€æœ‰ç« èŠ‚è¿›åº¦
        function loadProgress(courseId) {
            const all = JSON.parse(localStorage.getItem(PROGRESS_KEY) || "{}");
            return all[courseId] || {};
        }

        // åˆå¹¶ç”¨æˆ·è¿›åº¦åˆ°è¯¾ç¨‹æ•°æ®ä¸­ï¼ˆåŠ è½½åè°ƒç”¨ï¼‰
        function mergeProgressIntoCourses(courses) {
            return courses.map(course => {
                const progressMap = loadProgress(course.id);
                const updatedChapters = course.chapters.map((chapter, index) => {
                    const saved = progressMap[index] || {};
                    return {
                        ...chapter,
                        completed: saved.completed ?? false,
                        watchedSeconds: saved.watchedSeconds ?? 0,
                        lastVisited: saved.lastVisited ?? null,
                        isAutoCompleted: saved.isAutoCompleted ?? false
                    };
                });
                return {
                    ...course,
                    chapters: updatedChapters
                };
            });
        }
        function subjectApp() {
            return {
                currentSubjectType: 'public', // 'public' or 'professional'
                publicSubjects: [
                    {
                        id: 'math',
                        name: 'é«˜ç­‰æ•°å­¦',
                        description: 'æ•°å­¦ä¸€/æ•°å­¦äºŒ',
                        icon: 'fas fa-square-root-alt',
                        bgColor: 'from-blue-500 to-blue-600',
                        progress: 65,
                        completedChapters: 8,
                        chapters: [
                            { name: 'å‡½æ•°ä¸æé™', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'å¯¼æ•°ä¸å¾®åˆ†', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'ç§¯åˆ†å­¦', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å¤šå…ƒå‡½æ•°å¾®åˆ†å­¦', duration: '3.5å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'é‡ç§¯åˆ†', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'çº§æ•°', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'å¸¸å¾®åˆ†æ–¹ç¨‹', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'çº¿æ€§ä»£æ•°', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ¦‚ç‡è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ•°ç†ç»Ÿè®¡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'éšæœºå˜é‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ•°å­—ç‰¹å¾', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true }
                        ]
                    },
                    {
                        id: 'politics',
                        name: 'æ”¿æ²»',
                        description: 'é©¬åŸã€æ¯›æ¦‚ã€å²çº²ã€æ€ä¿®',
                        icon: 'fas fa-flag',
                        bgColor: 'from-red-500 to-red-600',
                        progress: 40,
                        completedChapters: 6,
                        chapters: [
                            { name: 'é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ¯›æ³½ä¸œæ€æƒ³æ¦‚è®º', duration: '3å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'é‚“å°å¹³ç†è®º', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'ä¸‰ä¸ªä»£è¡¨é‡è¦æ€æƒ³', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'ç§‘å­¦å‘å±•è§‚', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'ä¹ è¿‘å¹³æ–°æ—¶ä»£ç†è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'ä¸­å›½è¿‘ç°ä»£å²çº²è¦', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ€æƒ³é“å¾·ä¿®å…»', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'æ³•å¾‹åŸºç¡€', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'å½¢åŠ¿ä¸æ”¿ç­–', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'å½“ä»£ä¸–ç•Œç»æµ', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'å›½é™…å…³ç³»', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'æ—¶æ”¿çƒ­ç‚¹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'åˆ†æé¢˜æŠ€å·§', duration: '2å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'é€‰æ‹©é¢˜æŠ€å·§', duration: '1.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false }
                        ]
                    },
                    {
                        id: 'english',
                        name: 'è‹±è¯­äºŒ',
                        description: 'é˜…è¯»ã€å†™ä½œã€ç¿»è¯‘',
                        icon: 'fas fa-language',
                        bgColor: 'from-green-500 to-green-600',
                        progress: 55,
                        completedChapters: 5,
                        chapters: [
                            { name: 'è¯æ±‡åŸºç¡€', duration: '6å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'è¯­æ³•ç²¾è®²', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'é˜…è¯»ç†è§£æŠ€å·§', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å®Œå‹å¡«ç©º', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'æ–°é¢˜å‹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'ç¿»è¯‘æŠ€å·§', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å°ä½œæ–‡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'å¤§ä½œæ–‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'é•¿éš¾å¥åˆ†æ', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false }
                        ]
                    }
                ],
                professionalSubjects: [],
                publicSubjects: [
                    {
                        id: 1,
                        name: 'é«˜ç­‰æ•°å­¦',
                        description: 'æ•°å­¦ä¸€/æ•°å­¦äºŒ',
                        icon: 'fas fa-square-root-alt',
                        bgColor: 'from-blue-500 to-blue-600',
                        progress: 65,
                        completedChapters: 8,
                        chapters: [
                            { name: 'å‡½æ•°ä¸æé™', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'å¯¼æ•°ä¸å¾®åˆ†', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'ç§¯åˆ†å­¦', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å¤šå…ƒå‡½æ•°å¾®åˆ†å­¦', duration: '3.5å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'é‡ç§¯åˆ†', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'çº§æ•°', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'å¸¸å¾®åˆ†æ–¹ç¨‹', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'çº¿æ€§ä»£æ•°', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ¦‚ç‡è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ•°ç†ç»Ÿè®¡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'éšæœºå˜é‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ•°å­—ç‰¹å¾', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true }
                        ]
                    },
                    {
                        id: 2,
                        name: 'æ”¿æ²»',
                        description: 'é©¬åŸã€æ¯›æ¦‚ã€å²çº²ã€æ€ä¿®',
                        icon: 'fas fa-flag',
                        bgColor: 'from-red-500 to-red-600',
                        progress: 40,
                        completedChapters: 6,
                        chapters: [
                            { name: 'é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ¯›æ³½ä¸œæ€æƒ³æ¦‚è®º', duration: '3å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'é‚“å°å¹³ç†è®º', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'ä¸‰ä¸ªä»£è¡¨é‡è¦æ€æƒ³', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'ç§‘å­¦å‘å±•è§‚', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'ä¹ è¿‘å¹³æ–°æ—¶ä»£ç†è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'ä¸­å›½è¿‘ç°ä»£å²çº²è¦', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'æ€æƒ³é“å¾·ä¿®å…»', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'æ³•å¾‹åŸºç¡€', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'å½¢åŠ¿ä¸æ”¿ç­–', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'å½“ä»£ä¸–ç•Œç»æµ', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'å›½é™…å…³ç³»', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                            { name: 'æ—¶æ”¿çƒ­ç‚¹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'åˆ†æé¢˜æŠ€å·§', duration: '2å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                            { name: 'é€‰æ‹©é¢˜æŠ€å·§', duration: '1.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false }
                        ]
                    },
                    {
                        id: 3,
                        name: 'è‹±è¯­äºŒ',
                        description: 'é˜…è¯»ã€å†™ä½œã€ç¿»è¯‘',
                        icon: 'fas fa-language',
                        bgColor: 'from-green-500 to-green-600',
                        progress: 55,
                        completedChapters: 5,
                        chapters: [
                            { name: 'è¯æ±‡åŸºç¡€', duration: '6å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'è¯­æ³•ç²¾è®²', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                            { name: 'é˜…è¯»ç†è§£æŠ€å·§', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å®Œå‹å¡«ç©º', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'æ–°é¢˜å‹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'ç¿»è¯‘æŠ€å·§', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                            { name: 'å°ä½œæ–‡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                            { name: 'å¤§ä½œæ–‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                            { name: 'é•¿éš¾å¥åˆ†æ', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false }
                        ]
                    }
                ],
                coursesData: [],

                // ç¬”è®°ç›¸å…³æ•°æ®
                notesManager: null,
                showNotesModal: false,
                selectedNote: null,
                filteredNotes: [],
                allNoteTags: [],
                noteSearchQuery: '',
                noteFilterSubject: '',
                selectedTagFilters: [],
                newNoteTag: '',
                currentNoteSubject: null,
                showPreview: false,

                // çª—å£å¤§å°æ§åˆ¶
                modalSize: 'medium',
                modalWidth: 1024,
                modalHeight: 700,

                // å­¦ä¹ å»ºè®®ç›¸å…³
                studySuggestions: [],
                currentSuggestionIndex: 0,
                maxVisibleSuggestions: 3,

                init() {
                    // è·å–URLå‚æ•°
                    const urlParams = new URLSearchParams(window.location.search);
                    const type = urlParams.get('type');
                    if (type === 'professional') {
                        this.currentSubjectType = 'professional';
                    }

                    // åˆå§‹åŒ–ç¬”è®°ç®¡ç†å™¨
                    this.notesManager = new NotesManager();
                    this.loadNotesData();

                    // åŠ è½½çª—å£å¤§å°åå¥½
                    this.loadModalSizePreference();

                    // åŠ è½½è¯¾ç¨‹æ•°æ®
                    this.loadCoursesData();

                    // åˆå§‹åŒ–å­¦ä¹ å»ºè®®
                    this.initializeStudySuggestions();

                    // åˆå§‹åŒ–å­¦ä¹ ç»Ÿè®¡åŠŸèƒ½
                    this.initializeStudyStats();
                },

                // åˆå§‹åŒ–å­¦ä¹ ç»Ÿè®¡åŠŸèƒ½
                initializeStudyStats() {
                    let retryCount = 0;
                    const maxRetries = 5;
                    
                    const tryInit = () => {
                        if (window.studyStats) {
                            this.studyStatsManager = window.studyStats;
                            console.log('âœ… subjectsé¡µé¢å­¦ä¹ ç»Ÿè®¡å·²è¿æ¥');
                            // å¼ºåˆ¶é‡æ–°æ¸²æŸ“ç•Œé¢
                            this.$nextTick(() => {
                                console.log('ğŸ“Š å­¦ä¹ ç»Ÿè®¡æ•°æ®:', {
                                    todayStats: this.getTodayStudyTime(),
                                    dailyGoal: this.getDailyGoal(),
                                    hasStatsManager: !!this.studyStatsManager
                                });
                                // å¼ºåˆ¶ Alpine.js é‡æ–°æ¸²æŸ“
                                this.$el.dispatchEvent(new CustomEvent('refresh-stats'));
                            });
                        } else if (retryCount < maxRetries) {
                            retryCount++;
                            console.log(`â³ ç­‰å¾…å­¦ä¹ ç»Ÿè®¡ç®¡ç†å™¨åŠ è½½ä¸­... é‡è¯• ${retryCount}/${maxRetries}`);
                            setTimeout(tryInit, 500);
                        } else {
                            console.warn('âš ï¸ å­¦ä¹ ç»Ÿè®¡ç®¡ç†å™¨åŠ è½½è¶…æ—¶ï¼Œä½†ä¼šå°è¯•ä»æœ¬åœ°å­˜å‚¨è¯»å–æ•°æ®');
                            this.studyStatsManager = null;
                            // å³ä½¿æ²¡æœ‰ç®¡ç†å™¨ï¼Œä¹Ÿè¦åˆ·æ–°æ˜¾ç¤ºä»¥ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®
                            this.$nextTick(() => {
                                console.log('ğŸ“Š ä½¿ç”¨æœ¬åœ°å­˜å‚¨æ•°æ®:', {
                                    todayStats: this.getTodayStudyTime(),
                                    dailyGoal: this.getDailyGoal()
                                });
                            });
                        }
                    };
                    
                    tryInit();
                },

                // è·å–ä»Šæ—¥å­¦ä¹ æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
                getTodayStudyTime() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats) {
                        const todayStats = window.studyStats.getTodayStats();
                        return todayStats.studyTime || 0;
                    }
                    
                    // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­æ˜¯å¦æœ‰å­¦ä¹ è®°å½•
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            const today = new Date().toISOString().split('T')[0];
                            return stats.dailyStats?.[today]?.studyTime || 0;
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°å­¦ä¹ æ•°æ®å¤±è´¥:', error);
                    }
                    
                    // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œè¿”å›æ¨¡æ‹Ÿæ•°æ®ç”¨äºæ¼”ç¤º
                    console.log('âš ï¸ æ²¡æœ‰æ‰¾åˆ°å­¦ä¹ ç»Ÿè®¡æ•°æ®ï¼Œå»ºè®®å¼€å§‹å­¦ä¹ ä»¥è®°å½•æ•°æ®');
                    return 0;
                },

                // è·å–ä»Šæ—¥ç­”é¢˜æ•°é‡
                getTodayQuestions() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats) {
                        const todayStats = window.studyStats.getTodayStats();
                        return todayStats.questionsAnswered || 0;
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è·å–æ•°æ®
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            const today = new Date().toISOString().split('T')[0];
                            return stats.dailyStats?.[today]?.questionsAnswered || 0;
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°ç­”é¢˜æ•°æ®å¤±è´¥:', error);
                    }
                    return 0;
                },

                // è·å–ä»Šæ—¥æ­£ç¡®ç‡
                getTodayAccuracy() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats) {
                        const todayStats = window.studyStats.getTodayStats();
                        if (!todayStats.questionsAnswered || todayStats.questionsAnswered === 0) {
                            return 0;
                        }
                        return Math.round((todayStats.correctAnswers / todayStats.questionsAnswered) * 100);
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è®¡ç®—æ­£ç¡®ç‡
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            const today = new Date().toISOString().split('T')[0];
                            const todayData = stats.dailyStats?.[today];
                            if (todayData && todayData.questionsAnswered > 0) {
                                return Math.round((todayData.correctAnswers / todayData.questionsAnswered) * 100);
                            }
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°æ­£ç¡®ç‡æ•°æ®å¤±è´¥:', error);
                    }
                    return 0;
                },

                // è·å–æ¯æ—¥å­¦ä¹ æ—¶é•¿ç›®æ ‡ï¼ˆåˆ†é’Ÿï¼‰
                getDailyGoal() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats && window.studyStats.stats.goals) {
                        return window.studyStats.stats.goals.dailyStudyTime || 120;
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è·å–ç›®æ ‡
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            return stats.goals?.dailyStudyTime || 120;
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°ç›®æ ‡æ•°æ®å¤±è´¥:', error);
                    }
                    return 120; // é»˜è®¤2å°æ—¶
                },

                // è·å–æ¯æ—¥ç­”é¢˜ç›®æ ‡
                getDailyQuestionsGoal() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats && window.studyStats.stats.goals) {
                        return window.studyStats.stats.goals.dailyQuestions || 50;
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è·å–ç›®æ ‡
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            return stats.goals?.dailyQuestions || 50;
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°ç­”é¢˜ç›®æ ‡å¤±è´¥:', error);
                    }
                    return 50;
                },

                // è·å–æ­£ç¡®ç‡ç›®æ ‡
                getAccuracyGoal() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats && window.studyStats.stats.goals) {
                        return window.studyStats.stats.goals.targetAccuracy || 80;
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è·å–ç›®æ ‡
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            return stats.goals?.targetAccuracy || 80;
                        }
                    } catch (error) {
                        console.error('è¯»å–æœ¬åœ°æ­£ç¡®ç‡ç›®æ ‡å¤±è´¥:', error);
                    }
                    return 80;
                },

                // è·å–è¿ç»­å­¦ä¹ å¤©æ•°
                getStreakDays() {
                    // ä¼˜å…ˆä½¿ç”¨å…¨å±€ç»Ÿè®¡ç®¡ç†å™¨
                    if (window.studyStats && window.studyStats.stats) {
                        return window.studyStats.stats.streakDays || 0;
                    }
                    
                    // ä»æœ¬åœ°å­˜å‚¨è®¡ç®—è¿ç»­å¤©æ•°
                    try {
                        const stored = localStorage.getItem('study_statistics');
                        if (stored) {
                            const stats = JSON.parse(stored);
                            return stats.streakDays || 0;
                        }
                    } catch (error) {
                        console.error('è¯»å–è¿ç»­å¤©æ•°æ•°æ®å¤±è´¥:', error);
                    }
                    return 0;
                },

                // æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
                formatTime(minutes) {
                    if (!minutes || minutes === 0) return '0åˆ†é’Ÿ';
                    const hours = Math.floor(minutes / 60);
                    const mins = minutes % 60;
                    if (hours > 0) {
                        return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
                    }
                    return `${mins}m`;
                },

                // è·å–ä»Šæ—¥ç›®æ ‡å®Œæˆæƒ…å†µ
                getDailyGoalCompletionCount() {
                    const timeGoalMet = this.getTodayStudyTime() >= this.getDailyGoal();
                    const questionGoalMet = this.getTodayQuestions() >= this.getDailyQuestionsGoal();
                    const accuracyGoalMet = this.getTodayAccuracy() >= this.getAccuracyGoal();
                    
                    const completed = [timeGoalMet, questionGoalMet, accuracyGoalMet].filter(Boolean).length;
                    const total = 3;
                    
                    let message = '';
                    if (completed === total) {
                        message = 'ğŸ‰ æ­å–œï¼ä»Šæ—¥æ‰€æœ‰å­¦ä¹ ç›®æ ‡å·²å®Œæˆï¼';
                    } else if (completed === 0) {
                        message = 'ğŸ’ª å¼€å§‹ä»Šæ—¥çš„å­¦ä¹ ä¹‹æ—…ï¼Œå‘ç›®æ ‡å‡ºå‘ï¼';
                    } else {
                        message = `âš¡ å·²å®Œæˆ ${completed}/${total} ä¸ªç›®æ ‡ï¼Œç»§ç»­åŠ æ²¹ï¼`;
                    }
                    
                    return { completed, total, message };
                },

                // æ‰“å¼€ç»Ÿè®¡å¼¹çª—
                openStatsModal() {
                    if (window.openStatsModal) {
                        window.openStatsModal();
                    } else {
                        alert('ç»Ÿè®¡åŠŸèƒ½æ­£åœ¨åŠ è½½ä¸­ï¼Œè¯·ç¨åå†è¯•...');
                    }
                },

                async loadCoursesData() {
                    try {
                        console.log('å¼€å§‹åŠ è½½è¯¾ç¨‹æ•°æ®...');

                        // ä½¿ç”¨æ–°çš„èµ„æºåŠ è½½å™¨
                        const loader = window.resourceLoader;
                        if (loader) {
                            this.coursesData = await loader.loadJSON(
                                'bilibilicatgorybydifficulty.json',
                                window.fallbackCourseData || window.courseDataMain,
                                { useJSFallback: true }
                            );
                            this.coursesData = mergeProgressIntoCourses(this.coursesData);

                        } else {
                            // å¤‡ç”¨åŠ è½½æ–¹å¼
                            if (window.courseDataMain) {
                                this.coursesData = window.courseDataMain;
                            } else if (window.fallbackCourseData) {
                                this.coursesData = window.fallbackCourseData;
                            } else {
                                this.coursesData = this.getEmbeddedCoursesData();
                            }
                        }

                        console.log('è¯¾ç¨‹æ•°æ®åŠ è½½æˆåŠŸï¼Œæ€»æ•°:', this.coursesData.length);
                        console.log('è¯¾ç¨‹IDåˆ—è¡¨:', this.coursesData.map(c => `${c.id}: ${c.name}`));

                        this.setupSubjects();
                        // æ•°æ®åŠ è½½å®Œæˆåï¼Œæ¢å¤å­¦ä¹ è¿›åº¦
                        this.loadProgress();
                    } catch (error) {
                        console.error('åŠ è½½è¯¾ç¨‹æ•°æ®å¤±è´¥:', error);
                        console.log('ä½¿ç”¨é»˜è®¤æ•°æ®...');
                        this.setupDefaultSubjects();
                        // å³ä½¿ä½¿ç”¨é»˜è®¤æ•°æ®ï¼Œä¹Ÿå°è¯•åŠ è½½è¿›åº¦
                        this.loadProgress();
                    }
                },
                goToChapterPlayer(subjectId, chapterIndex, chapter) {
                    const title = encodeURIComponent(chapter.name || 'ç« èŠ‚');
                    const url = encodeURIComponent(chapter.url);
                    const playerUrl = `assets/html/player.html?subjectId=${subjectId}&chapterIndex=${chapterIndex}&title=${title}&url=${url}`;
                    window.open(playerUrl, '_blank');
                },
                getEmbeddedCoursesData() {
                    // å†…ç½®çš„è¯¾ç¨‹æ•°æ®ï¼ˆä»bilibilicatgorybydifficulty.jsonæå–çš„æ ¸å¿ƒéƒ¨åˆ†ï¼‰
                    return [
                        {
                            "id": 1,
                            "name": "é«˜ç­‰æ•°å­¦",
                            "desc": "æ•°å­¦ä¸€/äºŒ/ä¸‰å¿…å¤‡",
                            "icon": "fas fa-square-root-alt",
                            "color": "#3b82f6",
                            "chapters": [
                                { "name": "2026è€ƒç ”æ•°å­¦å¼ å®‡è€å¸ˆåŸºç¡€30è®²å¼•è¨€", "duration": "23åˆ†24ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1bez8YzEWn?p=1" },
                                { "name": "30è®²é›¶åŸºç¡€åŸºç¡€çŸ¥è¯†ç»“æ„01", "duration": "6åˆ†45ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1bez8YzEWn?p=2" },
                                { "name": "30è®²é›¶åŸºç¡€ åŸºæœ¬é€»è¾‘02", "duration": "1å°æ—¶5åˆ†", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1bez8YzEWn?p=3" },
                                { "name": "ç¬¬1è®² å‡½æ•°æé™ä¸è¿ç»­åŸºç¡€çŸ¥è¯†ç»“æ„01", "duration": "8åˆ†29ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1bez8YzEWn?p=16" },
                                { "name": "ç¬¬1è®² å‡½æ•°çš„æ¦‚å¿µä¸ç‰¹æ€§02", "duration": "51åˆ†43ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1bez8YzEWn?p=17" }
                            ]
                        },
                        {
                            "id": 2,
                            "name": "çº¿æ€§ä»£æ•°",
                            "desc": "çº¿ä»£å…¨å¥—è¯¦ç»†ç›®å½•",
                            "icon": "fas fa-th",
                            "color": "#06b6d4",
                            "chapters": [
                                { "name": "çº¿ä»£å¼•è¨€", "duration": "1å°æ—¶2åˆ†", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=1" },
                                { "name": "ç¬¬1è®² è¡Œåˆ—å¼åŸºç¡€çŸ¥è¯†ç»“æ„", "duration": "26åˆ†52ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=2" },
                                { "name": "ç¬¬1è®² è¡Œåˆ—å¼çš„æœ¬è´¨å®šä¹‰", "duration": "28åˆ†2ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=3" },
                                { "name": "ç¬¬1è®² è¡Œåˆ—å¼çš„æ€§è´¨", "duration": "49åˆ†51ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=4" },
                                { "name": "ç¬¬1è®² è¡Œåˆ—å¼çš„é€†åºæ•°æ³•", "duration": "31åˆ†41ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=5" },
                                { "name": "ç¬¬1è®² è¡Œåˆ—å¼çš„å±•å¼€å®šç†", "duration": "25åˆ†12ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=6" },
                                { "name": "ç¬¬2è®² çŸ©é˜µåŸºç¡€çŸ¥è¯†ç»“æ„", "duration": "5åˆ†52ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=13" },
                                { "name": "ç¬¬2è®² çŸ©é˜µçš„æ¦‚å¿µ", "duration": "18åˆ†58ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=14" },
                                { "name": "ç¬¬2è®² çŸ©é˜µçš„è¿ç®—", "duration": "40åˆ†45ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19U411d7ec?p=15" }
                            ]
                        },
                        {
                            "id": 3,
                            "name": "æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡",
                            "desc": "è€ƒç ”æ¦‚ç‡å¿…è€ƒ",
                            "icon": "fas fa-percentage",
                            "color": "#f59e42",
                            "chapters": [
                                { "name": "2026 åŸºç¡€30è®²æ¦‚ç‡å¼•è¨€", "duration": "20åˆ†25ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=1" },
                                { "name": "ç¬¬1è®² éšæœºäº‹ä»¶ä¸æ¦‚ç‡åŸºç¡€çŸ¥è¯†ç»“æ„", "duration": "5åˆ†1ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=2" },
                                { "name": "ç¬¬1è®² æ ·æœ¬ç©ºé—´ã€éšæœºäº‹ä»¶", "duration": "35åˆ†56ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=3" },
                                { "name": "ç¬¬1è®² é¢‘ç‡ä¸æ¦‚ç‡", "duration": "18åˆ†15ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=4" },
                                { "name": "ç¬¬1è®² ç­‰å¯èƒ½æ¦‚å‹ï¼ˆå¤å…¸æ¦‚å‹ï¼‰", "duration": "25åˆ†38ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=5" },
                                { "name": "ç¬¬1è®² å‡ ä½•æ¦‚å‹", "duration": "13åˆ†44ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=6" },
                                { "name": "ç¬¬1è®² æ¡ä»¶æ¦‚ç‡", "duration": "27åˆ†29ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=7" },
                                { "name": "ç¬¬1è®² äº‹ä»¶çš„ç‹¬ç«‹æ€§", "duration": "21åˆ†34ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1kqJMzZE27?p=8" }
                            ]
                        },
                        {
                            "id": 6,
                            "name": "æ•°æ®ç»“æ„",
                            "desc": "ç®—æ³•ä¸ç»“æ„åŸºç¡€",
                            "icon": "fas fa-code",
                            "color": "#a21caf",
                            "chapters": [
                                { "name": "1.0_å¼€ç¯‡_æ•°æ®ç»“æ„åœ¨å­¦ä»€ä¹ˆ", "duration": "7åˆ†59ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=2" },
                                { "name": "1.1_æ•°æ®ç»“æ„çš„åŸºæœ¬æ¦‚å¿µ", "duration": "22åˆ†29ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=3" },
                                { "name": "2.1_çº¿æ€§è¡¨çš„å®šä¹‰å’ŒåŸºæœ¬æ“ä½œ", "duration": "17åˆ†42ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=8" },
                                { "name": "2.2.1_é¡ºåºè¡¨çš„å®šä¹‰", "duration": "23åˆ†23ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=9" },
                                { "name": "3.1.1_æ ˆçš„åŸºæœ¬æ¦‚å¿µ", "duration": "9åˆ†42ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=20" },
                                { "name": "3.2.1_é˜Ÿåˆ—çš„åŸºæœ¬æ¦‚å¿µ", "duration": "4åˆ†9ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=23" },
                                { "name": "5.1.1+5.1.2_æ ‘çš„å®šä¹‰å’ŒåŸºæœ¬æœ¯è¯­", "duration": "15åˆ†17ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=41" },
                                { "name": "6.1.1_å›¾çš„åŸºæœ¬æ¦‚å¿µ", "duration": "30åˆ†39ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1b7411N798?p=58" }
                            ]
                        },
                        {
                            "id": 7,
                            "name": "æ“ä½œç³»ç»Ÿ",
                            "desc": "åŸç†ä¸å®æˆ˜",
                            "icon": "fas fa-microchip",
                            "color": "#eab308",
                            "chapters": [
                                { "name": "1.1.1+1.1.2 æ“ä½œç³»ç»Ÿçš„æ¦‚å¿µã€åŠŸèƒ½", "duration": "20åˆ†18ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=2" },
                                { "name": "2.1.1+2.1.2_è¿›ç¨‹çš„æ¦‚å¿µã€ç»„æˆã€ç‰¹å¾", "duration": "19åˆ†5ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=12" },
                                { "name": "2.1.6_1 çº¿ç¨‹çš„æ¦‚å¿µä¸ç‰¹ç‚¹", "duration": "10åˆ†34ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=17" },
                                { "name": "2.2.1 è°ƒåº¦çš„æ¦‚å¿µã€å±‚æ¬¡", "duration": "12åˆ†48ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=20" },
                                { "name": "2.3.1 åŒæ­¥ä¸äº’æ–¥çš„åŸºæœ¬æ¦‚å¿µ", "duration": "12åˆ†51ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=28" },
                                { "name": "2.4.1 æ­»é”çš„æ¦‚å¿µ", "duration": "17åˆ†3ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=39" },
                                { "name": "3.1.1_1 å†…å­˜çš„åŸºç¡€çŸ¥è¯†", "duration": "32åˆ†31ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1YE411D7nH?p=43" }
                            ]
                        },
                        {
                            "id": 8,
                            "name": "è®¡ç®—æœºç½‘ç»œ",
                            "desc": "åè®®ã€å±‚æ¬¡ã€å®è·µ",
                            "icon": "fas fa-network-wired",
                            "color": "#f43f5e",
                            "chapters": [
                                { "name": "1.1_1 è®¡ç®—æœºç½‘ç»œçš„æ¦‚å¿µï¼ˆå’¸é±¼ç‰ˆï¼‰", "duration": "22åˆ†11ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=2" },
                                { "name": "1.2.1 è®¡ç®—æœºç½‘ç»œåˆ†å±‚ç»“æ„ï¼ˆä¸Šï¼‰ï¼ˆå’¸é±¼ç‰ˆï¼‰", "duration": "21åˆ†30ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=9" },
                                { "name": "2.1.1 é€šä¿¡åŸºç¡€çš„åŸºæœ¬æ¦‚å¿µ(å’¸é±¼ç‰ˆï¼‰", "duration": "19åˆ†7ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=13" },
                                { "name": "3.1 æ•°æ®é“¾è·¯å±‚çš„åŠŸèƒ½ï¼ˆå’¸é±¼ç‰ˆï¼‰", "duration": "11åˆ†26ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=19" },
                                { "name": "4.1 ç½‘ç»œå±‚çš„åŠŸèƒ½ï¼ˆå’¸é±¼ç‰ˆï¼‰", "duration": "16åˆ†47ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=43" },
                                { "name": "5.1 ä¼ è¾“å±‚æä¾›çš„æœåŠ¡ï¼ˆå’¸é±¼ç‰ˆï¼‰", "duration": "30åˆ†21ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV19E411D78Q?p=56" }
                            ]
                        },
                        {
                            "id": 9,
                            "name": "è®¡ç®—æœºç»„æˆåŸç†",
                            "desc": "ç¡¬ä»¶é€»è¾‘ç»“æ„",
                            "icon": "fas fa-cogs",
                            "color": "#0ea5e9",
                            "chapters": [
                                { "name": "1.0_ä½ å¥½ï¼Œæˆ‘æ˜¯è®¡ç®—æœºç»„æˆåŸç†", "duration": "10åˆ†27ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1ps4y1d73V?p=2" },
                                { "name": "1.2.1+1.2.2_è®¡ç®—æœºç¡¬ä»¶çš„åŸºæœ¬ç»„æˆ", "duration": "15åˆ†33ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1ps4y1d73V?p=4" },
                                { "name": "2.1.1_è¿›ä½è®¡æ•°åˆ¶", "duration": "40åˆ†3ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1ps4y1d73V?p=10" },
                                { "name": "3.1_å­˜å‚¨ç³»ç»ŸåŸºæœ¬æ¦‚å¿µ", "duration": "28åˆ†14ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1ps4y1d73V?p=33" },
                                { "name": "5.1_CPUçš„åŠŸèƒ½å’ŒåŸºæœ¬ç»“æ„", "duration": "33åˆ†20ç§’", "difficulty": "ä¸­ç­‰", "completed": false, "url": "https://www.bilibili.com/video/BV1ps4y1d73V?p=62" }
                            ]
                        }
                    ];
                },

                setupSubjects() {
                    console.log('å¼€å§‹è®¾ç½®ç§‘ç›®æ•°æ®...');
                    console.log('åŸå§‹è¯¾ç¨‹æ•°æ®:', this.coursesData);

                    // è®¾ç½®å…¬å…±è¯¾ï¼ˆid: 1-5ï¼šé«˜æ•°ã€çº¿ä»£ã€æ¦‚ç‡è®ºã€è‹±è¯­ã€æ”¿æ²»ï¼‰
                    const publicCourseIds = [1, 2, 3, 4, 5];
                    this.publicSubjects = this.coursesData
                        .filter(course => publicCourseIds.includes(course.id))
                        .map(course => this.transformCourseData(course));

                    console.log('å…¬å…±è¯¾æ•°é‡:', this.publicSubjects.length);
                    console.log('å…¬å…±è¯¾ç§‘ç›®:', this.publicSubjects.map(s => `${s.id}: ${s.name}`));

                    // è®¾ç½®ä¸“ä¸šè¯¾ï¼ˆid: 6-9ï¼šæ•°æ®ç»“æ„ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºç½‘ç»œã€è®¡ç®—æœºç»„æˆåŸç†ï¼‰
                    const professionalCourseIds = [6, 7, 8, 9];
                    this.professionalSubjects = this.coursesData
                        .filter(course => professionalCourseIds.includes(course.id))
                        .map(course => this.transformCourseData(course));

                    console.log('ä¸“ä¸šè¯¾æ•°é‡:', this.professionalSubjects.length);
                    console.log('ä¸“ä¸šè¯¾ç§‘ç›®:', this.professionalSubjects.map(s => `${s.id}: ${s.name}`));

                    // å¦‚æœå¤–éƒ¨æ•°æ®åŠ è½½å¤±è´¥æˆ–ä¸å®Œæ•´ï¼Œè¡¥å……å†…ç½®æ•°æ®
                    if (this.publicSubjects.length < 5 || this.professionalSubjects.length < 4) {
                        console.log('å¤–éƒ¨æ•°æ®ä¸å®Œæ•´ï¼Œä½¿ç”¨å†…ç½®æ•°æ®è¡¥å……...');
                        this.setupDefaultSubjects();
                    }
                },

                transformCourseData(course) {
                    const bgColorMap = {
                        1: 'from-blue-500 to-blue-600',        // é«˜ç­‰æ•°å­¦
                        2: 'from-cyan-500 to-cyan-600',        // çº¿æ€§ä»£æ•°
                        3: 'from-orange-500 to-orange-600',    // æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡
                        4: 'from-green-500 to-green-600',      // è‹±è¯­äºŒ
                        5: 'from-red-500 to-red-600',          // æ”¿æ²»
                        6: 'from-purple-500 to-purple-600',    // æ•°æ®ç»“æ„
                        7: 'from-yellow-500 to-yellow-600',    // æ“ä½œç³»ç»Ÿ
                        8: 'from-pink-500 to-pink-600',        // è®¡ç®—æœºç½‘ç»œ
                        9: 'from-indigo-500 to-indigo-600'     // è®¡ç®—æœºç»„æˆåŸç†
                    };

                    const completedChapters = course.chapters ? course.chapters.filter(ch => ch.completed).length : 0;
                    const totalChapters = course.chapters ? course.chapters.length : 0;
                    const progress = totalChapters > 0 ? Math.round((completedChapters / totalChapters) * 100) : 0;

                    return {
                        id: course.id,
                        name: course.name,
                        description: course.desc,
                        icon: course.icon,
                        bgColor: bgColorMap[course.id] || 'from-gray-500 to-gray-600',
                        progress: progress,
                        completedChapters: completedChapters,
                        chapters: course.chapters || []
                    };
                },

                setupDefaultSubjects() {
                    console.log('è®¾ç½®é»˜è®¤ç§‘ç›®æ•°æ®...');
                    // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤çš„å…¬å…±è¯¾æ•°æ®
                    this.publicSubjects = [
                        {
                            id: 1,
                            name: 'é«˜ç­‰æ•°å­¦',
                            description: 'æ•°å­¦ä¸€/æ•°å­¦äºŒ',
                            icon: 'fas fa-square-root-alt',
                            bgColor: 'from-blue-500 to-blue-600',
                            progress: 65,
                            completedChapters: 8,
                            chapters: [
                                { name: 'å‡½æ•°ä¸æé™', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'å¯¼æ•°ä¸å¾®åˆ†', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'ç§¯åˆ†å­¦', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                                { name: 'å¤šå…ƒå‡½æ•°å¾®åˆ†å­¦', duration: '3.5å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'é‡ç§¯åˆ†', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'çº§æ•°', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'å¸¸å¾®åˆ†æ–¹ç¨‹', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'çº¿æ€§ä»£æ•°', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ¦‚ç‡è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ•°ç†ç»Ÿè®¡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'éšæœºå˜é‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ•°å­—ç‰¹å¾', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true }
                            ]
                        },
                        {
                            id: 2,
                            name: 'çº¿æ€§ä»£æ•°',
                            description: 'æ•°å­¦å¿…ä¿®è¯¾ç¨‹',
                            icon: 'fas fa-calculator',
                            bgColor: 'from-cyan-500 to-cyan-600',
                            progress: 40,
                            completedChapters: 3,
                            chapters: [
                                { name: 'è¡Œåˆ—å¼', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'çŸ©é˜µ', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'å‘é‡ç»„çš„çº¿æ€§ç›¸å…³æ€§', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                                { name: 'çº¿æ€§æ–¹ç¨‹ç»„', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'çŸ©é˜µçš„ç‰¹å¾å€¼', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'äºŒæ¬¡å‹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false }
                            ]
                        },
                        {
                            id: 3,
                            name: 'æ¦‚ç‡è®ºä¸æ•°ç†ç»Ÿè®¡',
                            description: 'æ•°å­¦ä¸€/ä¸‰å¿…ä¿®',
                            icon: 'fas fa-chart-bar',
                            bgColor: 'from-orange-500 to-orange-600',
                            progress: 30,
                            completedChapters: 2,
                            chapters: [
                                { name: 'éšæœºäº‹ä»¶ä¸æ¦‚ç‡', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'éšæœºå˜é‡åŠå…¶åˆ†å¸ƒ', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                                { name: 'å¤šç»´éšæœºå˜é‡', duration: '3.5å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'æ•°å­—ç‰¹å¾', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'å¤§æ•°å®šå¾‹ä¸ä¸­å¿ƒæé™å®šç†', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'å‚æ•°ä¼°è®¡', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: false }
                            ]
                        },
                        {
                            id: 4,
                            name: 'æ”¿æ²»',
                            description: 'æ€æƒ³æ”¿æ²»ç†è®º',
                            icon: 'fas fa-flag',
                            bgColor: 'from-red-500 to-red-600',
                            progress: 40,
                            completedChapters: 6,
                            chapters: [
                                { name: 'é©¬å…‹æ€ä¸»ä¹‰åŸºæœ¬åŸç†', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ¯›æ³½ä¸œæ€æƒ³æ¦‚è®º', duration: '3å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'é‚“å°å¹³ç†è®º', duration: '2.5å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'ä¸‰ä¸ªä»£è¡¨é‡è¦æ€æƒ³', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                                { name: 'ç§‘å­¦å‘å±•è§‚', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: false },
                                { name: 'ä¹ è¿‘å¹³æ–°æ—¶ä»£ç†è®º', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'ä¸­å›½è¿‘ç°ä»£å²çº²è¦', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ€æƒ³é“å¾·ä¿®å…»', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'æ³•å¾‹åŸºç¡€', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'å½¢åŠ¿ä¸æ”¿ç­–', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                                { name: 'å½“ä»£ä¸–ç•Œç»æµ', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'å›½é™…å…³ç³»', duration: '1.5å°æ—¶', difficulty: 'ç®€å•', completed: false },
                                { name: 'æ—¶æ”¿çƒ­ç‚¹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'åˆ†æé¢˜æŠ€å·§', duration: '2å°æ—¶', difficulty: 'å›°éš¾', completed: false },
                                { name: 'é€‰æ‹©é¢˜æŠ€å·§', duration: '1.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false }
                            ]
                        },
                        {
                            id: 5,
                            name: 'è‹±è¯­',
                            description: 'è‹±è¯­ä¸€/äºŒ',
                            icon: 'fas fa-language',
                            bgColor: 'from-green-500 to-green-600',
                            progress: 55,
                            completedChapters: 5,
                            chapters: [
                                { name: 'è¯æ±‡åŸºç¡€', duration: '6å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'è¯­æ³•ç²¾è®²', duration: '4å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'é˜…è¯»ç†è§£æŠ€å·§', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                                { name: 'å®Œå‹å¡«ç©º', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'æ–°é¢˜å‹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'ç¿»è¯‘æŠ€å·§', duration: '2.5å°æ—¶', difficulty: 'å›°éš¾', completed: true },
                                { name: 'å°ä½œæ–‡', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true },
                                { name: 'å¤§ä½œæ–‡', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false },
                                { name: 'é•¿éš¾å¥åˆ†æ', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false }
                            ]
                        }
                    ];

                    // æ·»åŠ é»˜è®¤çš„ä¸“ä¸šè¯¾æ•°æ®
                    this.professionalSubjects = [
                        {
                            id: 6,
                            name: 'æ•°æ®ç»“æ„',
                            description: 'çº¿æ€§è¡¨ã€æ ‘ã€å›¾ã€æŸ¥æ‰¾æ’åº',
                            icon: 'fas fa-sitemap',
                            bgColor: 'from-purple-500 to-purple-600',
                            progress: 80,
                            completedChapters: 7,
                            chapters: [
                                { name: 'çº¿æ€§è¡¨', duration: '3å°æ—¶', difficulty: 'ç®€å•', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=8' },
                                { name: 'æ ˆå’Œé˜Ÿåˆ—', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=20' },
                                { name: 'ä¸²', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=33' },
                                { name: 'æ•°ç»„ä¸å¹¿ä¹‰è¡¨', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true },
                                { name: 'æ ‘å’ŒäºŒå‰æ ‘', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=41' },
                                { name: 'å›¾', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=58' },
                                { name: 'æŸ¥æ‰¾', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true, url: 'https://www.bilibili.com/video/BV1b7411N798?p=72' },
                                { name: 'å†…éƒ¨æ’åº', duration: '3.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false, url: 'https://www.bilibili.com/video/BV1b7411N798?p=90' },
                                { name: 'å¤–éƒ¨æ’åº', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false, url: 'https://www.bilibili.com/video/BV1b7411N798?p=101' }
                            ]
                        },
                        {
                            id: 7,
                            name: 'æ“ä½œç³»ç»Ÿ',
                            description: 'è¿›ç¨‹ã€å†…å­˜ã€æ–‡ä»¶ç³»ç»Ÿ',
                            icon: 'fas fa-desktop',
                            bgColor: 'from-orange-500 to-orange-600',
                            progress: 60,
                            completedChapters: 5,
                            chapters: [
                                { name: 'æ“ä½œç³»ç»Ÿæ¦‚è¿°', duration: '2å°æ—¶', difficulty: 'ç®€å•', completed: true, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=2' },
                                { name: 'è¿›ç¨‹ç®¡ç†', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=12' },
                                { name: 'çº¿ç¨‹', duration: '2å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=17' },
                                { name: 'å¤„ç†æœºè°ƒåº¦', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: true, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=20' },
                                { name: 'åŒæ­¥ä¸é€šä¿¡', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: true, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=28' },
                                { name: 'æ­»é”', duration: '2.5å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=39' },
                                { name: 'å†…å­˜ç®¡ç†', duration: '4å°æ—¶', difficulty: 'å›°éš¾', completed: false, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=43' },
                                { name: 'è™šæ‹Ÿå†…å­˜', duration: '3å°æ—¶', difficulty: 'å›°éš¾', completed: false, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=55' },
                                { name: 'æ–‡ä»¶ç³»ç»Ÿ', duration: '3å°æ—¶', difficulty: 'ä¸­ç­‰', completed: false, url: 'https://www.bilibili.com/video/BV1YE411D7nH?p=60' }
                            ]
                        }
                    ];

                    console.log('é»˜è®¤æ•°æ®è®¾ç½®å®Œæˆ - å…¬å…±è¯¾:', this.publicSubjects.length, 'ä¸“ä¸šè¯¾:', this.professionalSubjects.length);
                },

                get currentSubjects() {
                    return this.currentSubjectType === 'public' ? this.publicSubjects : this.professionalSubjects;
                },

                get totalChapters() {
                    return this.currentSubjects.reduce((total, subject) => total + subject.chapters.length, 0);
                },

                get completedChapters() {
                    return this.currentSubjects.reduce((total, subject) =>
                        total + subject.chapters.filter(ch => ch.completed).length, 0);
                },

                get overallProgress() {
                    if (this.totalChapters === 0) return 0;
                    return Math.round((this.completedChapters / this.totalChapters) * 100);
                },

                toggleChapter(subjectId, chapterIndex, { auto = false } = {}) {
                    const subject = this.currentSubjects.find(s => s.id === subjectId);
                    if (!subject || !subject.chapters[chapterIndex]) return;

                    const chapter = subject.chapters[chapterIndex];

                    if (auto && chapter.url) {
                        // è‡ªåŠ¨è·³è½¬æ’­æ”¾
                        window.open(chapter.url, '_blank');
                        this.showToast(`ğŸ¥ æ­£åœ¨æ‰“å¼€è§†é¢‘: ${chapter.name}`, 'info');
                    }

                    // åˆ‡æ¢å®ŒæˆçŠ¶æ€
                    chapter.completed = !chapter.completed;

                    // æ›´æ–°è¿›åº¦
                    const completed = subject.chapters.filter(ch => ch.completed).length;
                    subject.progress = Math.round((completed / subject.chapters.length) * 100);
                    subject.completedChapters = completed;

                    this.showToast(chapter.completed ? 'âœ… å·²æ ‡è®°å®Œæˆ' : 'ğŸ“ å–æ¶ˆå®ŒæˆçŠ¶æ€', chapter.completed ? 'success' : 'info');

                    this.saveProgress();
                },


                getDifficultyColor(difficulty) {
                    switch (difficulty) {
                        case 'ç®€å•': return 'bg-green-100 text-green-800';
                        case 'ä¸­ç­‰': return 'bg-yellow-100 text-yellow-800';
                        case 'å›°éš¾': return 'bg-red-100 text-red-800';
                        default: return 'bg-gray-100 text-gray-800';
                    }
                },

                startStudy(subjectId) {
                    // æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœªå®Œæˆçš„ç« èŠ‚
                    const subject = this.currentSubjects.find(s => s.id === subjectId);
                    if (subject) {
                        const nextChapter = subject.chapters.find(ch => !ch.completed);
                        if (nextChapter) {
                            this.showToast(`ğŸ¯ å¼€å§‹å­¦ä¹ : ${subject.name} - ${nextChapter.name}`, 'info');

                            // å¯åŠ¨å­¦ä¹ ç»Ÿè®¡ä¼šè¯
                            if (window.studyStats) {
                                window.studyStats.startStudySession(subject.name, nextChapter.name);
                                console.log('ğŸ“Š å·²å¯åŠ¨å­¦ä¹ ç»Ÿè®¡è¿½è¸ª:', { subject: subject.name, chapter: nextChapter.name });
                            }

                            // å¦‚æœæœ‰è§†é¢‘é“¾æ¥ï¼Œæ‰“å¼€è§†é¢‘
                            if (nextChapter.url) {
                                window.open(nextChapter.url, '_blank');
                                this.showToast(`ğŸ¥ æ­£åœ¨æ‰“å¼€è§†é¢‘: ${nextChapter.name}`, 'info');

                                // æ ‡è®°ä¸ºå·²å®Œæˆ
                                nextChapter.completed = true;

                                // é‡æ–°è®¡ç®—è¿›åº¦
                                const completed = subject.chapters.filter(ch => ch.completed).length;
                                subject.progress = Math.round((completed / subject.chapters.length) * 100);
                                subject.completedChapters = completed;

                                this.saveProgress();
                            }
                        } else {
                            this.showToast('ğŸ‰ è¯¥ç§‘ç›®æ‰€æœ‰ç« èŠ‚å·²å®Œæˆï¼', 'success');
                        }
                    }
                },
                goToChapterVideo(subjectId, chapterIndex) {
                    const subject = this.currentSubjects.find(s => s.id === subjectId);
                    const chapter = subject?.chapters?.[chapterIndex];
                    if (!chapter || !chapter.url) return;

                    const redirectUrl = `redirect.html?subjectId=${subjectId}&chapterIndex=${chapterIndex}&url=${encodeURIComponent(chapter.url)}`;
                    window.open(redirectUrl, '_blank');

                    this.showToast(`ğŸ¥ æ­£åœ¨è·³è½¬è‡³ ${chapter.name}`, 'info');
                },

                saveProgress() {
                    try {
                        const progressData = {
                            publicSubjects: this.publicSubjects,
                            professionalSubjects: this.professionalSubjects,
                            lastUpdated: new Date().toISOString()
                        };
                        localStorage.setItem('study_progress', JSON.stringify(progressData));
                    } catch (error) {
                        console.error('ä¿å­˜è¿›åº¦å¤±è´¥:', error);
                    }
                },

                loadProgress() {
                    try {
                        const saved = localStorage.getItem('study_progress');
                        if (saved) {
                            const progressData = JSON.parse(saved);
                            // æ¢å¤è¿›åº¦æ•°æ®
                            if (progressData.publicSubjects) {
                                this.publicSubjects.forEach(subject => {
                                    const savedSubject = progressData.publicSubjects.find(s => s.id === subject.id);
                                    if (savedSubject) {
                                        subject.chapters.forEach((chapter, index) => {
                                            if (savedSubject.chapters[index]) {
                                                chapter.completed = savedSubject.chapters[index].completed || false;
                                            }
                                        });
                                        // é‡æ–°è®¡ç®—è¿›åº¦
                                        const completed = subject.chapters.filter(ch => ch.completed).length;
                                        subject.progress = Math.round((completed / subject.chapters.length) * 100);
                                        subject.completedChapters = completed;
                                    }
                                });
                            }
                            if (progressData.professionalSubjects) {
                                this.professionalSubjects.forEach(subject => {
                                    const savedSubject = progressData.professionalSubjects.find(s => s.id === subject.id);
                                    if (savedSubject) {
                                        subject.chapters.forEach((chapter, index) => {
                                            if (savedSubject.chapters[index]) {
                                                chapter.completed = savedSubject.chapters[index].completed || false;
                                            }
                                        });
                                        // é‡æ–°è®¡ç®—è¿›åº¦
                                        const completed = subject.chapters.filter(ch => ch.completed).length;
                                        subject.progress = Math.round((completed / subject.chapters.length) * 100);
                                        subject.completedChapters = completed;
                                    }
                                });
                            }
                        }
                    } catch (error) {
                        console.error('åŠ è½½è¿›åº¦å¤±è´¥:', error);
                    }
                },

                showNotes(subjectId) {
                    // è®¾ç½®å½“å‰ç§‘ç›®
                    this.currentNoteSubject = this.currentSubjects.find(s => s.id === subjectId);
                    this.noteFilterSubject = subjectId;

                    // æ˜¾ç¤ºç¬”è®°å¼¹çª—
                    this.showNotesModal = true;

                    // åˆ·æ–°ç¬”è®°æ•°æ®
                    this.loadNotesData();
                    this.filterNotes();
                },

                showStats(subjectId) {
                    this.showToast('ğŸ“Š ç»Ÿè®¡åŠŸèƒ½å¼€å‘ä¸­...', 'info');
                },

                showToast(message, type = 'info') {
                    // åˆ›å»ºä¸´æ—¶æç¤ºæ¡†
                    const toast = document.createElement('div');
                    toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 transition-all duration-300 ${type === 'success' ? 'bg-green-500' :
                            type === 'error' ? 'bg-red-500' : 'bg-blue-500'
                        }`;
                    toast.textContent = message;
                    document.body.appendChild(toast);

                    // 3ç§’åè‡ªåŠ¨ç§»é™¤
                    setTimeout(() => {
                        toast.style.opacity = '0';
                        setTimeout(() => toast.remove(), 300);
                    }, 3000);
                },

                // è®¡ç®—å±æ€§ï¼šè·å–æ‰€æœ‰ç§‘ç›®
                get allSubjects() {
                    return [...this.publicSubjects, ...this.professionalSubjects];
                },

                // ==================== ç¬”è®°åŠŸèƒ½æ–¹æ³• ====================

                // åŠ è½½ç¬”è®°æ•°æ®
                loadNotesData() {
                    if (!this.notesManager) return;

                    const notes = this.notesManager.getAllNotes();
                    console.log('åŠ è½½ç¬”è®°æ•°æ®ï¼Œæ€»æ•°:', notes.length);

                    // æ›´æ–°ç¬”è®°çš„ç§‘ç›®å’Œç« èŠ‚åç§°ï¼Œä½¿ç”¨æ›´å‡†ç¡®çš„åŒ¹é…
                    this.filteredNotes = notes.map(note => {
                        const subject = this.allSubjects.find(s => s.id == note.subjectId);
                        let chapter = null;

                        if (subject && subject.chapters) {
                            // ä¼˜å…ˆä½¿ç”¨ç« èŠ‚åç§°åŒ¹é…
                            chapter = subject.chapters.find(c =>
                                c.name === note.chapterId
                            );
                        }

                        return {
                            ...note,
                            subjectName: subject?.name || 'æœªçŸ¥ç§‘ç›®',
                            chapterName: chapter?.name || note.chapterId || 'æœªé€‰æ‹©ç« èŠ‚'
                        };
                    });

                    console.log('å¤„ç†åçš„ç¬”è®°æ•°æ®:', this.filteredNotes.map(n => ({
                        id: n.id,
                        title: n.title,
                        subjectName: n.subjectName,
                        chapterName: n.chapterName
                    })));

                    // æ›´æ–°æ ‡ç­¾åˆ—è¡¨
                    this.allNoteTags = this.notesManager.getAllTags();
                },

                // åˆ›å»ºæ–°ç¬”è®°
                createNewNote() {
                    const subjectId = this.currentNoteSubject?.id || this.allSubjects[0]?.id || '';
                    const subject = this.allSubjects.find(s => s.id == subjectId);

                    const newNote = this.notesManager.createNote(
                        'æ–°å»ºç¬”è®°',
                        '',
                        subjectId,
                        '',
                        []
                    );

                    // æ›´æ–°ç¬”è®°ä¿¡æ¯
                    newNote.subjectName = subject?.name || 'æœªçŸ¥ç§‘ç›®';
                    newNote.chapterName = 'æœªé€‰æ‹©ç« èŠ‚';

                    // é€‰ä¸­æ–°ç¬”è®°
                    this.selectedNote = newNote;

                    // åˆ·æ–°ç¬”è®°åˆ—è¡¨
                    this.loadNotesData();
                    this.filterNotes();
                },

                // é€‰æ‹©ç¬”è®°
                selectNote(note) {
                    this.selectedNote = { ...note };
                },

                // æ›´æ–°é€‰ä¸­çš„ç¬”è®°
                updateSelectedNote() {
                    if (!this.selectedNote || !this.notesManager) {
                        console.warn('updateSelectedNote: ç¼ºå°‘å¿…è¦çš„å¯¹è±¡', {
                            hasSelectedNote: !!this.selectedNote,
                            hasNotesManager: !!this.notesManager
                        });
                        return;
                    }

                    // æ›´æ–°ç§‘ç›®å’Œç« èŠ‚åç§°
                    const subject = this.allSubjects.find(s => s.id == this.selectedNote.subjectId);
                    let chapter = null;

                    if (subject && subject.chapters) {
                        // ä¼˜å…ˆä½¿ç”¨ç« èŠ‚åç§°åŒ¹é…
                        chapter = subject.chapters.find(c =>
                            c.name === this.selectedNote.chapterId
                        );
                    }

                    this.selectedNote.subjectName = subject?.name || 'æœªçŸ¥ç§‘ç›®';
                    this.selectedNote.chapterName = chapter?.name || this.selectedNote.chapterId || 'æœªé€‰æ‹©ç« èŠ‚';

                    console.log('æ›´æ–°ç¬”è®°ä¿¡æ¯:', {
                        noteId: this.selectedNote.id,
                        title: this.selectedNote.title,
                        subjectId: this.selectedNote.subjectId,
                        subjectName: this.selectedNote.subjectName,
                        chapterId: this.selectedNote.chapterId,
                        chapterName: this.selectedNote.chapterName
                    });

                    // ä¿å­˜åˆ°ç®¡ç†å™¨
                    try {
                        this.notesManager.updateNote(this.selectedNote.id, this.selectedNote);
                        console.log('ç¬”è®°æ›´æ–°æˆåŠŸ');
                    } catch (error) {
                        console.error('ä¿å­˜ç¬”è®°å¤±è´¥:', error);
                        this.showToast('ä¿å­˜ç¬”è®°å¤±è´¥: ' + error.message, 'error');
                    }

                    // åˆ·æ–°åˆ—è¡¨
                    this.loadNotesData();
                    this.filterNotes();
                },

                // åˆ é™¤ç¬”è®°
                deleteNote(noteId) {
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç¬”è®°å—ï¼Ÿ')) {
                        this.notesManager.deleteNote(noteId);

                        // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰é€‰ä¸­çš„ç¬”è®°ï¼Œæ¸…ç©ºé€‰ä¸­çŠ¶æ€
                        if (this.selectedNote && this.selectedNote.id === noteId) {
                            this.selectedNote = null;
                        }

                        // åˆ·æ–°åˆ—è¡¨
                        this.loadNotesData();
                        this.filterNotes();

                        this.showToast('ç¬”è®°å·²åˆ é™¤', 'success');
                    }
                },

                // æœç´¢ç¬”è®°
                searchNotes() {
                    this.filterNotes();
                },

                // ç­›é€‰ç¬”è®°
                filterNotes() {
                    if (!this.notesManager) return;

                    let notes = this.notesManager.getAllNotes();

                    // æŒ‰ç§‘ç›®ç­›é€‰
                    if (this.noteFilterSubject) {
                        notes = notes.filter(note => note.subjectId == this.noteFilterSubject);
                    }

                    // æŒ‰æ ‡ç­¾ç­›é€‰
                    if (this.selectedTagFilters.length > 0) {
                        notes = notes.filter(note =>
                            this.selectedTagFilters.some(tag => note.tags.includes(tag))
                        );
                    }

                    // æŒ‰æœç´¢è¯ç­›é€‰
                    if (this.noteSearchQuery.trim()) {
                        const query = this.noteSearchQuery.toLowerCase();
                        notes = notes.filter(note =>
                            note.title.toLowerCase().includes(query) ||
                            note.content.toLowerCase().includes(query) ||
                            note.tags.some(tag => tag.toLowerCase().includes(query))
                        );
                    }

                    // æ›´æ–°æ˜¾ç¤ºåç§°
                    this.filteredNotes = notes.map(note => {
                        const subject = this.allSubjects.find(s => s.id == note.subjectId);
                        const chapter = subject?.chapters?.find(c => c.name === note.chapterId);

                        return {
                            ...note,
                            subjectName: subject?.name || 'æœªçŸ¥ç§‘ç›®',
                            chapterName: chapter?.name || note.chapterId || 'æœªé€‰æ‹©ç« èŠ‚'
                        };
                    });
                },

                // åˆ‡æ¢æ ‡ç­¾ç­›é€‰
                toggleTagFilter(tag) {
                    const index = this.selectedTagFilters.indexOf(tag);
                    if (index > -1) {
                        this.selectedTagFilters.splice(index, 1);
                    } else {
                        this.selectedTagFilters.push(tag);
                    }
                    this.filterNotes();
                },

                // æ·»åŠ æ ‡ç­¾
                addNoteTag() {
                    if (!this.selectedNote || !this.newNoteTag.trim()) return;

                    const tag = this.newNoteTag.trim();
                    if (!this.selectedNote.tags.includes(tag)) {
                        this.selectedNote.tags.push(tag);
                        this.updateSelectedNote();
                        this.loadNotesData(); // æ›´æ–°å…¨å±€æ ‡ç­¾åˆ—è¡¨
                    }

                    this.newNoteTag = '';
                },

                // ç§»é™¤æ ‡ç­¾
                removeNoteTag(tag) {
                    if (!this.selectedNote) return;

                    const index = this.selectedNote.tags.indexOf(tag);
                    if (index > -1) {
                        this.selectedNote.tags.splice(index, 1);
                        this.updateSelectedNote();
                    }
                },
                // è·å–æŒ‡å®šç§‘ç›®çš„ç« èŠ‚
                getChaptersBySubject(subjectId) {
                    if (!subjectId) {
                        console.warn('getChaptersBySubject: æœªæä¾›ç§‘ç›®ID');
                        return [];
                    }

                    // æ ¸å¿ƒä¿®æ­£ï¼šIDéƒ½è½¬ä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒ
                    const subject = this.allSubjects.find(s => String(s.id) === String(subjectId));
                    if (!subject) {
                        console.warn(`getChaptersBySubject: æœªæ‰¾åˆ°ç§‘ç›®ID ${subjectId}`, this.allSubjects.map(s => s.id));
                        return [];
                    }

                    const chapters = Array.isArray(subject.chapters) ? subject.chapters : [];

                    console.log(`è·å–ç§‘ç›® ${subjectId} (${subject.name}) çš„ç« èŠ‚:`, {
                        subjectName: subject.name,
                        chapterCount: chapters.length,
                        chapters: chapters.slice(0, 3).map(c => ({
                            name: c.name,
                            hasUrl: !!c.url
                        }))
                    });

                    return chapters;
                },


                // æ ¼å¼åŒ–ç¬”è®°æ—¥æœŸ
                formatNoteDate(dateString) {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('zh-CN', {
                        month: '2-digit',
                        day: '2-digit',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },

                // å¯¼å‡ºé€‰ä¸­çš„ç¬”è®°
                exportSelectedNote() {
                    if (!this.selectedNote || !this.notesManager) return;

                    const markdown = this.notesManager.exportNoteAsMarkdown(this.selectedNote.id);
                    if (markdown) {
                        this.downloadText(markdown, `${this.selectedNote.title}.md`);
                        this.showToast('ç¬”è®°å·²å¯¼å‡º', 'success');
                    }
                },

                // å¯¼å‡ºæ‰€æœ‰ç¬”è®°ä¸ºJSONæ–‡ä»¶
                exportAllNotesAsFile() {
                    if (!this.notesManager) return;

                    if (this.notesManager.exportNotesToFile()) {
                        this.showToast('âœ… æ‰€æœ‰ç¬”è®°å·²å¯¼å‡ºä¸ºå¤‡ä»½æ–‡ä»¶', 'success');
                    } else {
                        this.showToast('âŒ å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                    }
                },

                // å¯¼å…¥ç¬”è®°æ–‡ä»¶
                async importNotesFromFile() {
                    if (!this.notesManager) return;

                    try {
                        const result = await this.notesManager.triggerImportDialog();

                        // åˆ·æ–°ç¬”è®°æ•°æ®
                        this.loadNotesData();
                        this.filterNotes();
                        this.selectedNote = null;

                        this.showToast(
                            `âœ… æˆåŠŸå¯¼å…¥ ${result.imported} æ¡ç¬”è®°ï¼Œå½“å‰æ€»è®¡ ${result.total} æ¡`,
                            'success'
                        );
                    } catch (error) {
                        if (error.message !== 'ç”¨æˆ·å–æ¶ˆ') {
                            console.error('å¯¼å…¥ç¬”è®°å¤±è´¥:', error);
                            this.showToast('âŒ å¯¼å…¥å¤±è´¥: ' + error.message, 'error');
                        }
                    }
                },

                // ä¸‹è½½æ–‡æœ¬æ–‡ä»¶
                downloadText(content, filename) {
                    const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = filename;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(link.href);
                },

                // æ’å…¥Markdownæ ¼å¼
                insertMarkdown(before, after) {
                    const textarea = this.$refs.noteTextarea;
                    if (!textarea || !this.selectedNote) return;

                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const selectedText = this.selectedNote.content.substring(start, end);

                    const newText = before + selectedText + after;
                    this.selectedNote.content =
                        this.selectedNote.content.substring(0, start) +
                        newText +
                        this.selectedNote.content.substring(end);

                    this.updateSelectedNote();

                    // é‡æ–°è®¾ç½®å…‰æ ‡ä½ç½®
                    this.$nextTick(() => {
                        textarea.focus();
                        textarea.setSelectionRange(start + before.length, start + before.length + selectedText.length);
                    });
                },

                // åˆ‡æ¢é¢„è§ˆæ¨¡å¼
                togglePreview() {
                    this.showPreview = !this.showPreview;
                },

                // æ¸²æŸ“Markdown
                renderMarkdown(content) {
                    if (!content) return '';
                    return SimpleMarkdownRenderer.render(content);
                },

                // è°ƒèŠ‚ç¬”è®°çª—å£å¤§å°
                resizeModal(size) {
                    this.modalSize = size;
                    switch (size) {
                        case 'small':
                            this.modalWidth = 800;
                            this.modalHeight = 600;
                            break;
                        case 'medium':
                            this.modalWidth = 1024;
                            this.modalHeight = 700;
                            break;
                        case 'large':
                            this.modalWidth = 1400;
                            this.modalHeight = 800;
                            break;
                    }

                    // ä¿å­˜ç”¨æˆ·åå¥½
                    try {
                        localStorage.setItem('notes_modal_size', JSON.stringify({
                            size: this.modalSize,
                            width: this.modalWidth,
                            height: this.modalHeight
                        }));
                    } catch (error) {
                        console.warn('ä¿å­˜çª—å£å¤§å°åå¥½å¤±è´¥:', error);
                    }
                },

                // åŠ è½½çª—å£å¤§å°åå¥½
                loadModalSizePreference() {
                    try {
                        const saved = localStorage.getItem('notes_modal_size');
                        if (saved) {
                            const preference = JSON.parse(saved);
                            this.modalSize = preference.size || 'medium';
                            this.modalWidth = preference.width || 1024;
                            this.modalHeight = preference.height || 700;
                        }
                    } catch (error) {
                        console.warn('åŠ è½½çª—å£å¤§å°åå¥½å¤±è´¥:', error);
                    }
                },

                // ==================== å­¦ä¹ å»ºè®®åŠŸèƒ½ ====================

                // åˆå§‹åŒ–å­¦ä¹ å»ºè®®
                initializeStudySuggestions() {
                    this.studySuggestions = this.generateStudySuggestions();
                    this.currentSuggestionIndex = 0;
                },

                // ç”Ÿæˆå­¦ä¹ å»ºè®®
                generateStudySuggestions() {
                    const suggestions = [];
                    const currentSubjects = this.currentSubjects;

                    if (!currentSubjects || currentSubjects.length === 0) {
                        return this.getDefaultSuggestions();
                    }

                    // åŸºäºå½“å‰è¿›åº¦ç”Ÿæˆå»ºè®®
                    currentSubjects.forEach(subject => {
                        const nextChapter = subject.chapters.find(ch => !ch.completed);
                        const completedCount = subject.chapters.filter(ch => ch.completed).length;

                        if (nextChapter) {
                            suggestions.push({
                                type: 'today',
                                icon: 'fas fa-lightbulb',
                                color: 'yellow-500',
                                title: 'ä»Šæ—¥æ¨è',
                                content: `å»ºè®®å­¦ä¹ ${subject.name}çš„"${nextChapter.name}"`,
                                detail: `é¢„è®¡ç”¨æ—¶ ${nextChapter.duration || '1å°æ—¶'}`,
                                subjectId: subject.id,
                                chapterName: nextChapter.name
                            });
                        }

                        if (subject.progress < 30) {
                            suggestions.push({
                                type: 'weak',
                                icon: 'fas fa-target',
                                color: 'red-500',
                                title: 'è–„å¼±ç¯èŠ‚',
                                content: `${subject.name}è¿›åº¦è¾ƒæ…¢ï¼Œéœ€è¦åŠ å¼ºå­¦ä¹ `,
                                detail: `å½“å‰è¿›åº¦ ${subject.progress}%`,
                                subjectId: subject.id
                            });
                        }

                        if (subject.progress >= 70) {
                            suggestions.push({
                                type: 'achievement',
                                icon: 'fas fa-trophy',
                                color: 'green-500',
                                title: 'å­¦ä¹ æˆæœ',
                                content: `${subject.name}å­¦ä¹ è¿›å±•è‰¯å¥½ï¼å·²å®Œæˆ${completedCount}ä¸ªç« èŠ‚`,
                                detail: `ç»§ç»­ä¿æŒï¼Œäº‰å–å…¨éƒ¨å®Œæˆ`,
                                subjectId: subject.id
                            });
                        }
                    });

                    // ç”Ÿæˆç»¼åˆå»ºè®®
                    const overallProgress = this.overallProgress;
                    if (overallProgress >= 50) {
                        suggestions.push({
                            type: 'motivation',
                            icon: 'fas fa-rocket',
                            color: 'blue-500',
                            title: 'å­¦ä¹ åŠ¨åŠ›',
                            content: `æ€»ä½“è¿›åº¦å·²è¾¾åˆ°${overallProgress}%ï¼Œå­¦ä¹ çŠ¶æ€å¾ˆå¥½ï¼`,
                            detail: 'ä¿æŒè¿™ä¸ªèŠ‚å¥ï¼Œèƒœåˆ©åœ¨æœ›'
                        });
                    }

                    // æ·»åŠ ä¸€äº›é€šç”¨å»ºè®®
                    const genericSuggestions = [
                        {
                            type: 'schedule',
                            icon: 'fas fa-calendar-alt',
                            color: 'purple-500',
                            title: 'å­¦ä¹ è®¡åˆ’',
                            content: 'å»ºè®®åˆ¶å®šæ¯æ—¥å­¦ä¹ è®¡åˆ’ï¼Œä¿æŒè§„å¾‹æ€§',
                            detail: 'æ¯å¤©å›ºå®šæ—¶é—´å­¦ä¹ æ•ˆæœæ›´ä½³'
                        },
                        {
                            type: 'review',
                            icon: 'fas fa-redo',
                            color: 'orange-500',
                            title: 'å¤ä¹ å·©å›º',
                            content: 'å®šæœŸå›é¡¾å·²å­¦å†…å®¹ï¼ŒåŠ æ·±è®°å¿†',
                            detail: 'å»ºè®®æ¯å‘¨å¤ä¹ ä¸€æ¬¡'
                        },
                        {
                            type: 'practice',
                            icon: 'fas fa-dumbbell',
                            color: 'indigo-500',
                            title: 'ç»ƒä¹ å¼ºåŒ–',
                            content: 'å¤šåšç»ƒä¹ é¢˜ï¼Œæå‡è§£é¢˜èƒ½åŠ›',
                            detail: 'ç†è®ºä¸å®è·µç›¸ç»“åˆ'
                        }
                    ];

                    // éšæœºæ·»åŠ ä¸€äº›é€šç”¨å»ºè®®
                    const randomGeneric = this.shuffleArray(genericSuggestions).slice(0, 2);
                    suggestions.push(...randomGeneric);

                    // éšæœºæ’åºå¹¶è¿”å›
                    return this.shuffleArray(suggestions);
                },

                // è·å–é»˜è®¤å»ºè®®ï¼ˆå½“æ²¡æœ‰ç§‘ç›®æ•°æ®æ—¶ï¼‰
                getDefaultSuggestions() {
                    return [
                        {
                            type: 'welcome',
                            icon: 'fas fa-star',
                            color: 'blue-500',
                            title: 'æ¬¢è¿å­¦ä¹ ',
                            content: 'å¼€å§‹ä½ çš„è€ƒç ”å­¦ä¹ ä¹‹æ—…ï¼',
                            detail: 'åˆ¶å®šåˆç†çš„å­¦ä¹ è®¡åˆ’'
                        },
                        {
                            type: 'explore',
                            icon: 'fas fa-compass',
                            color: 'green-500',
                            title: 'æ¢ç´¢è¯¾ç¨‹',
                            content: 'æµè§ˆå„ä¸ªç§‘ç›®ï¼Œäº†è§£å­¦ä¹ å†…å®¹',
                            detail: 'é€‰æ‹©æ„Ÿå…´è¶£çš„ç§‘ç›®å¼€å§‹å­¦ä¹ '
                        },
                        {
                            type: 'goal',
                            icon: 'fas fa-bullseye',
                            color: 'red-500',
                            title: 'è®¾å®šç›®æ ‡',
                            content: 'ä¸ºè‡ªå·±è®¾å®šæ˜ç¡®çš„å­¦ä¹ ç›®æ ‡',
                            detail: 'æœ‰ç›®æ ‡æ‰æœ‰åŠ¨åŠ›'
                        }
                    ];
                },

                // æ•°ç»„éšæœºæ’åº
                shuffleArray(array) {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                },

                // è·å–å½“å‰æ˜¾ç¤ºçš„å»ºè®®
                get currentSuggestions() {
                    return this.studySuggestions.slice(
                        this.currentSuggestionIndex,
                        this.currentSuggestionIndex + this.maxVisibleSuggestions
                    );
                },

                // æ¢ä¸€æ¢å»ºè®®
                refreshSuggestions() {
                    // ç§»åŠ¨åˆ°ä¸‹ä¸€ç»„å»ºè®®
                    const nextIndex = this.currentSuggestionIndex + this.maxVisibleSuggestions;
                    if (nextIndex >= this.studySuggestions.length) {
                        // å¦‚æœåˆ°è¾¾æœ«å°¾ï¼Œé‡æ–°ç”Ÿæˆå»ºè®®
                        this.studySuggestions = this.generateStudySuggestions();
                        this.currentSuggestionIndex = 0;
                    } else {
                        this.currentSuggestionIndex = nextIndex;
                    }

                    this.showToast('ğŸ”„ å»ºè®®å·²æ›´æ–°', 'info');
                },

                // æ‰§è¡Œå»ºè®®çš„è¡ŒåŠ¨
                applySuggestion(suggestion) {
                    if (suggestion.subjectId && suggestion.chapterName) {
                        // å¦‚æœæ˜¯å…·ä½“çš„ç« èŠ‚å»ºè®®ï¼Œè·³è½¬åˆ°è¯¥ç« èŠ‚
                        const subject = this.currentSubjects.find(s => s.id === suggestion.subjectId);
                        if (subject) {
                            const chapter = subject.chapters.find(ch => ch.name === suggestion.chapterName);
                            if (chapter && chapter.url) {
                                window.open(chapter.url, '_blank');
                                this.showToast(`ğŸ¥ æ­£åœ¨æ‰“å¼€: ${suggestion.chapterName}`, 'info');
                            }
                        }
                    } else if (suggestion.subjectId) {
                        // å¦‚æœæ˜¯ç§‘ç›®å»ºè®®ï¼Œå¼€å§‹å­¦ä¹ è¯¥ç§‘ç›®
                        this.startStudy(suggestion.subjectId);
                    } else {
                        // é€šç”¨å»ºè®®çš„å¤„ç†
                        this.showToast(`ğŸ’¡ ${suggestion.content}`, 'info');
                    }
                }
            };
        }
    </script>

    <!-- ç¬”è®°ç®¡ç†å™¨ -->
    <script src="assets/js/notes-manager.js"></script>
    <!-- ç« èŠ‚é€‰æ‹©å™¨ -->
    <script src="assets/js/chapter-selector.js"></script>
    
    <!-- å¿«æ·å¯¼èˆªæ  -->
    <script src="assets/js/quick-nav.js"></script>
</body>

</html>