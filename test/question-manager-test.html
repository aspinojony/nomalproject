<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¢˜ç›®ç®¡ç†å·¥å…·æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .test-success {
            background: #d4edda;
            color: #155724;
        }
        .test-error {
            background: #f8d7da;
            color: #721c24;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover {
            background: #0056b3;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <h1>é¢˜ç›®ç®¡ç†å·¥å…·æµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testBasicFunctions()">æµ‹è¯•åŸºç¡€åŠŸèƒ½</button>
        <button onclick="testAddQuestion()">æµ‹è¯•æ·»åŠ é¢˜ç›®</button>
        <button onclick="testSearch()">æµ‹è¯•æœç´¢åŠŸèƒ½</button>
        <button onclick="testExport()">æµ‹è¯•å¯¼å‡ºåŠŸèƒ½</button>
        <div id="basic-results"></div>
    </div>

    <div class="test-section">
        <h2>æ•°æ®å¯¼å…¥æµ‹è¯•</h2>
        <button onclick="generateTestCSV()">ç”Ÿæˆæµ‹è¯•CSVæ–‡ä»¶</button>
        <button onclick="generateTestJSON()">ç”Ÿæˆæµ‹è¯•JSONæ–‡ä»¶</button>
        <div id="import-results"></div>
    </div>

    <div class="test-section">
        <h2>æ•°æ®ç®¡ç†æµ‹è¯•</h2>
        <button onclick="showStats()">æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯</button>
        <button onclick="testBatchOperations()">æµ‹è¯•æ‰¹é‡æ“ä½œ</button>
        <button onclick="clearAllData()" class="btn-danger">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
        <div id="management-results"></div>
    </div>

    <div class="test-section">
        <h2>å®é™…é¢˜ç›®ç®¡ç†ç•Œé¢</h2>
        <p>ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è®¿é—®å®Œæ•´çš„é¢˜ç›®ç®¡ç†ç•Œé¢ï¼š</p>
        <a href="question-manager.html" target="_blank" style="color: #007bff; text-decoration: none; font-weight: bold;">
            â–º æ‰“å¼€é¢˜ç›®ç®¡ç†å·¥å…·
        </a>
    </div>

    <!-- åŠ è½½é¢˜åº“ç®¡ç†å™¨ -->
    <script src="assets/js/question-bank-manager.js"></script>
    
    <script>
        function showResult(containerId, message, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'test-success' : 'test-error'}`;
            div.innerHTML = message;
            container.appendChild(div);
        }

        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        function testBasicFunctions() {
            clearResults('basic-results');
            
            try {
                // æµ‹è¯•é¢˜åº“ç®¡ç†å™¨æ˜¯å¦æ­£å¸¸åŠ è½½
                if (typeof window.questionBank === 'undefined') {
                    throw new Error('é¢˜åº“ç®¡ç†å™¨æœªæ­£ç¡®åŠ è½½');
                }
                
                showResult('basic-results', 'âœ“ é¢˜åº“ç®¡ç†å™¨åŠ è½½æˆåŠŸ');
                
                // è·å–ç»Ÿè®¡ä¿¡æ¯
                const stats = window.questionBank.getStatistics();
                showResult('basic-results', `âœ“ å½“å‰é¢˜ç›®æ€»æ•°: ${stats.total}`);
                showResult('basic-results', `âœ“ ç§‘ç›®æ•°é‡: ${Object.keys(stats.by_subject).length}`);
                
                // æµ‹è¯•ç­›é€‰åŠŸèƒ½
                const filtered = window.questionBank.getFilteredQuestions({ subject: 'æ•°æ®ç»“æ„' });
                showResult('basic-results', `âœ“ æ•°æ®ç»“æ„é¢˜ç›®æ•°é‡: ${filtered.length}`);
                
            } catch (error) {
                showResult('basic-results', `âœ— åŸºç¡€åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        function testAddQuestion() {
            clearResults('basic-results');
            
            try {
                const testQuestion = {
                    subject: 'æµ‹è¯•ç§‘ç›®',
                    chapter: 'æµ‹è¯•ç« èŠ‚',
                    year: 2024,
                    difficulty: 'ä¸­ç­‰',
                    points: 3,
                    question: 'è¿™æ˜¯ä¸€é“æµ‹è¯•é¢˜ç›®ï¼Œç”¨äºéªŒè¯é¢˜ç›®æ·»åŠ åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ',
                    options: ['é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D'],
                    correct_answer: 1,
                    explanation: 'è¿™æ˜¯æµ‹è¯•é¢˜ç›®çš„è§£æè¯´æ˜ã€‚',
                    tags: ['æµ‹è¯•', 'éªŒè¯', 'åŠŸèƒ½']
                };
                
                const result = window.questionBank.addQuestion(testQuestion);
                showResult('basic-results', `âœ“ é¢˜ç›®æ·»åŠ æˆåŠŸï¼ŒID: ${result.id}`);
                
                // éªŒè¯é¢˜ç›®æ˜¯å¦çœŸçš„æ·»åŠ äº†
                const added = window.questionBank.getQuestion(result.id);
                if (added) {
                    showResult('basic-results', 'âœ“ é¢˜ç›®æ•°æ®éªŒè¯æˆåŠŸ');
                } else {
                    throw new Error('æ·»åŠ çš„é¢˜ç›®æ— æ³•æ‰¾åˆ°');
                }
                
            } catch (error) {
                showResult('basic-results', `âœ— æ·»åŠ é¢˜ç›®æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        function testSearch() {
            clearResults('basic-results');
            
            try {
                // æœç´¢æµ‹è¯•
                const searchResults = window.questionBank.searchQuestions('çº¿æ€§è¡¨');
                showResult('basic-results', `âœ“ æœç´¢"çº¿æ€§è¡¨"æ‰¾åˆ° ${searchResults.length} ä¸ªç»“æœ`);
                
                // æ ‡ç­¾æœç´¢
                const tagResults = window.questionBank.searchQuestions('ç®—æ³•');
                showResult('basic-results', `âœ“ æœç´¢"ç®—æ³•"æ‰¾åˆ° ${tagResults.length} ä¸ªç»“æœ`);
                
                // ç©ºæœç´¢ï¼ˆåº”è¯¥è¿”å›æ‰€æœ‰ï¼‰
                const allResults = window.questionBank.searchQuestions('');
                showResult('basic-results', `âœ“ ç©ºæœç´¢è¿”å› ${allResults.length} ä¸ªç»“æœ`);
                
            } catch (error) {
                showResult('basic-results', `âœ— æœç´¢åŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        function testExport() {
            clearResults('basic-results');
            
            try {
                // æµ‹è¯•JSONå¯¼å‡º
                const jsonData = window.questionBank.exportQuestions('json');
                const jsonObj = JSON.parse(jsonData);
                showResult('basic-results', `âœ“ JSONå¯¼å‡ºæˆåŠŸï¼ŒåŒ…å« ${jsonObj.questions.length} é“é¢˜ç›®`);
                
                // æµ‹è¯•CSVå¯¼å‡º
                const csvData = window.questionBank.exportQuestions('csv');
                const lines = csvData.split('\\n').filter(line => line.trim());
                showResult('basic-results', `âœ“ CSVå¯¼å‡ºæˆåŠŸï¼ŒåŒ…å« ${lines.length - 1} æ¡æ•°æ®è®°å½•ï¼ˆä¸å«æ ‡é¢˜è¡Œï¼‰`);
                
            } catch (error) {
                showResult('basic-results', `âœ— å¯¼å‡ºåŠŸèƒ½æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        function generateTestCSV() {
            clearResults('import-results');
            
            const csvContent = `subject,chapter,year,difficulty,points,question,options,correct_answer,explanation,tags
è®¡ç®—æœºç½‘ç»œ,ç½‘ç»œåè®®,2024,ç®€å•,2,"HTTPåè®®é»˜è®¤ä½¿ç”¨å“ªä¸ªç«¯å£ï¼Ÿ","80|443|21|23",0,"HTTPåè®®é»˜è®¤ä½¿ç”¨80ç«¯å£è¿›è¡Œé€šä¿¡","HTTP|ç«¯å£|åè®®
æ•°æ®åº“,å…³ç³»æ¨¡å‹,2024,ä¸­ç­‰,3,"ä¸‹åˆ—å“ªé¡¹ä¸æ˜¯å…³ç³»æ•°æ®åº“çš„ç‰¹ç‚¹ï¼Ÿ","æ•°æ®ç‹¬ç«‹æ€§|æ•°æ®ä¸€è‡´æ€§|å±‚æ¬¡ç»“æ„|å®Œæ•´æ€§çº¦æŸ",2,"å…³ç³»æ•°æ®åº“æ˜¯åŸºäºå…³ç³»æ¨¡å‹çš„ï¼Œä¸ä½¿ç”¨å±‚æ¬¡ç»“æ„","æ•°æ®åº“|å…³ç³»æ¨¡å‹|ç‰¹ç‚¹"
ç®—æ³•è®¾è®¡,æ’åºç®—æ³•,2024,å›°éš¾,4,"å¿«é€Ÿæ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯ï¼Ÿ","O(n)|O(n log n)|O(nÂ²)|O(log n)",1,"å¿«é€Ÿæ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦æ˜¯O(n log n)","å¿«é€Ÿæ’åº|æ—¶é—´å¤æ‚åº¦|ç®—æ³•åˆ†æ"`;

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'test-questions.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showResult('import-results', 'âœ“ æµ‹è¯•CSVæ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸‹è½½');
        }

        function generateTestJSON() {
            clearResults('import-results');
            
            const jsonData = {
                metadata: {
                    version: "2.0",
                    description: "æµ‹è¯•é¢˜ç›®æ•°æ®",
                    total_questions: 2
                },
                questions: [
                    {
                        subject: "æ“ä½œç³»ç»Ÿ",
                        chapter: "å†…å­˜ç®¡ç†",
                        year: 2024,
                        difficulty: "ä¸­ç­‰",
                        points: 3,
                        question: "è™šæ‹Ÿå†…å­˜çš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ",
                        options: [
                            "æé«˜CPUé€Ÿåº¦",
                            "æ‰©å¤§å†…å­˜å®¹é‡",
                            "å‡å°‘å†…å­˜è®¿é—®æ—¶é—´",
                            "æé«˜ç£ç›˜é€Ÿåº¦"
                        ],
                        correct_answer: 1,
                        explanation: "è™šæ‹Ÿå†…å­˜æŠ€æœ¯å¯ä»¥ä½¿ç¨‹åºçœ‹èµ·æ¥æ‹¥æœ‰æ¯”ç‰©ç†å†…å­˜æ›´å¤§çš„å†…å­˜ç©ºé—´ã€‚",
                        tags: ["è™šæ‹Ÿå†…å­˜", "å†…å­˜ç®¡ç†", "æ“ä½œç³»ç»Ÿ"]
                    },
                    {
                        subject: "ç¼–è¯‘åŸç†",
                        chapter: "è¯æ³•åˆ†æ",
                        year: 2024,
                        difficulty: "å›°éš¾",
                        points: 4,
                        question: "ç¼–è¯‘å™¨çš„è¯æ³•åˆ†æå™¨ä¸»è¦åŠŸèƒ½æ˜¯ï¼Ÿ",
                        options: [
                            "è¯­æ³•æ£€æŸ¥",
                            "ç”Ÿæˆç›®æ ‡ä»£ç ",
                            "è¯†åˆ«å•è¯ç¬¦å·",
                            "ä¼˜åŒ–ä»£ç "
                        ],
                        correct_answer: 2,
                        explanation: "è¯æ³•åˆ†æå™¨è´Ÿè´£å°†æºç¨‹åºçš„å­—ç¬¦åºåˆ—è½¬æ¢ä¸ºå•è¯ç¬¦å·åºåˆ—ã€‚",
                        tags: ["è¯æ³•åˆ†æ", "ç¼–è¯‘å™¨", "å•è¯ç¬¦å·"]
                    }
                ]
            };

            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'test-questions.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showResult('import-results', 'âœ“ æµ‹è¯•JSONæ–‡ä»¶å·²ç”Ÿæˆå¹¶ä¸‹è½½');
        }

        function showStats() {
            clearResults('management-results');
            
            try {
                const stats = window.questionBank.getStatistics();
                
                showResult('management-results', `ğŸ“Š <strong>é¢˜ç›®ç»Ÿè®¡ä¿¡æ¯</strong>`);
                showResult('management-results', `æ€»é¢˜ç›®æ•°ï¼š${stats.total}`);
                
                if (Object.keys(stats.by_subject).length > 0) {
                    let subjectStats = 'æŒ‰ç§‘ç›®ç»Ÿè®¡ï¼š<br>';
                    Object.entries(stats.by_subject).forEach(([subject, count]) => {
                        subjectStats += `&nbsp;&nbsp;â€¢ ${subject}: ${count} é¢˜<br>`;
                    });
                    showResult('management-results', subjectStats);
                }
                
                if (Object.keys(stats.by_year).length > 0) {
                    let yearStats = 'æŒ‰å¹´ä»½ç»Ÿè®¡ï¼š<br>';
                    Object.entries(stats.by_year)
                        .sort((a, b) => b[0] - a[0])
                        .forEach(([year, count]) => {
                            yearStats += `&nbsp;&nbsp;â€¢ ${year}å¹´: ${count} é¢˜<br>`;
                        });
                    showResult('management-results', yearStats);
                }
                
                if (Object.keys(stats.by_difficulty).length > 0) {
                    let difficultyStats = 'æŒ‰éš¾åº¦ç»Ÿè®¡ï¼š<br>';
                    Object.entries(stats.by_difficulty).forEach(([difficulty, count]) => {
                        difficultyStats += `&nbsp;&nbsp;â€¢ ${difficulty}: ${count} é¢˜<br>`;
                    });
                    showResult('management-results', difficultyStats);
                }
                
            } catch (error) {
                showResult('management-results', `âœ— è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ${error.message}`, false);
            }
        }

        function testBatchOperations() {
            clearResults('management-results');
            
            try {
                // æ·»åŠ å‡ é“æµ‹è¯•é¢˜ç›®ç”¨äºæ‰¹é‡æ“ä½œ
                const testQuestions = [];
                for (let i = 1; i <= 3; i++) {
                    const question = window.questionBank.addQuestion({
                        subject: 'æ‰¹é‡æµ‹è¯•',
                        chapter: 'æµ‹è¯•ç« èŠ‚',
                        year: 2024,
                        difficulty: 'ç®€å•',
                        points: 1,
                        question: `æ‰¹é‡æµ‹è¯•é¢˜ç›®${i}ï¼Ÿ`,
                        options: ['é€‰é¡¹A', 'é€‰é¡¹B', 'é€‰é¡¹C', 'é€‰é¡¹D'],
                        correct_answer: 0,
                        explanation: `è¿™æ˜¯æ‰¹é‡æµ‹è¯•é¢˜ç›®${i}çš„è§£æã€‚`,
                        tags: ['æ‰¹é‡æµ‹è¯•', `é¢˜ç›®${i}`]
                    });
                    testQuestions.push(question.id);
                }
                
                showResult('management-results', `âœ“ æˆåŠŸæ·»åŠ  ${testQuestions.length} é“æµ‹è¯•é¢˜ç›®`);
                
                // æµ‹è¯•å¤åˆ¶åŠŸèƒ½
                const duplicated = window.questionBank.duplicateQuestion(testQuestions[0]);
                if (duplicated) {
                    showResult('management-results', `âœ“ å¤åˆ¶é¢˜ç›®æˆåŠŸï¼Œæ–°ID: ${duplicated.id}`);
                    testQuestions.push(duplicated.id);
                }
                
                // æµ‹è¯•æ‰¹é‡åˆ é™¤
                const deleteResult = window.questionBank.batchDeleteQuestions(testQuestions);
                showResult('management-results', `âœ“ æ‰¹é‡åˆ é™¤å®Œæˆï¼šæˆåŠŸåˆ é™¤ ${deleteResult.deleted.length} é“é¢˜ç›®ï¼Œå¤±è´¥ ${deleteResult.failed.length} é“`);
                
            } catch (error) {
                showResult('management-results', `âœ— æ‰¹é‡æ“ä½œæµ‹è¯•å¤±è´¥: ${error.message}`, false);
            }
        }

        function clearAllData() {
            if (confirm('ç¡®è®¤è¦æ¸…ç©ºæ‰€æœ‰é¢˜ç›®æ•°æ®å—ï¼Ÿè¿™ä¸ªæ“ä½œä¸å¯æ¢å¤ï¼')) {
                try {
                    localStorage.removeItem('question_bank');
                    location.reload();
                } catch (error) {
                    showResult('management-results', `âœ— æ¸…ç©ºæ•°æ®å¤±è´¥: ${error.message}`, false);
                }
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                testBasicFunctions();
            }, 500);
        });
    </script>
</body>
</html>