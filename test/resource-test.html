<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–éƒ¨æ–‡ä»¶åŠ è½½æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../assets/css/common.css" rel="stylesheet">
    <script src="../assets/js/course-data.js"></script>
    <script src="../assets/js/fallback-data.js"></script>
    <script src="../assets/js/resource-loader.js"></script>
</head>
<body class="bg-gray-50" x-data="testApp()">
    <div class="container mx-auto px-4 py-8">
        <h1 class="text-3xl font-bold text-center mb-8 fade-in-up">å¤–éƒ¨æ–‡ä»¶åŠ è½½æµ‹è¯•</h1>
        
        <!-- åŠ è½½çŠ¶æ€æ˜¾ç¤º -->
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in-up stagger-1">
                <i class="fas fa-file-alt text-4xl text-blue-500 mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">CSSæ–‡ä»¶</h3>
                <p class="text-gray-600" x-text="cssStatus"></p>
                <div class="mt-2">
                    <span class="text-sm" :class="cssLoaded ? 'text-green-600' : 'text-orange-600'" 
                          x-text="cssLoaded ? 'âœ… å·²åŠ è½½' : 'â³ åŠ è½½ä¸­'"></span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in-up stagger-2">
                <i class="fas fa-database text-4xl text-green-500 mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">JSONæ•°æ®</h3>
                <p class="text-gray-600" x-text="jsonStatus"></p>
                <div class="mt-2">
                    <span class="text-sm" :class="jsonLoaded ? 'text-green-600' : 'text-orange-600'" 
                          x-text="jsonLoaded ? 'âœ… å·²åŠ è½½' : 'â³ åŠ è½½ä¸­'"></span>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg p-6 card-hover fade-in-up stagger-3">
                <i class="fas fa-code text-4xl text-purple-500 mb-4"></i>
                <h3 class="text-xl font-semibold mb-2">JavaScript</h3>
                <p class="text-gray-600" x-text="jsStatus"></p>
                <div class="mt-2">
                    <span class="text-sm" :class="jsLoaded ? 'text-green-600' : 'text-orange-600'" 
                          x-text="jsLoaded ? 'âœ… å·²åŠ è½½' : 'â³ åŠ è½½ä¸­'"></span>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•æŒ‰é’® -->
        <div class="text-center mb-8">
            <button @click="testLoad()" 
                    class="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-all duration-300 transform hover:scale-105 button-press">
                <i class="fas fa-sync-alt mr-2"></i>
                é‡æ–°æµ‹è¯•åŠ è½½
            </button>
        </div>

        <!-- æ•°æ®é¢„è§ˆ -->
        <div class="bg-white rounded-lg shadow-lg p-6" x-show="courseData.length > 0">
            <h3 class="text-xl font-semibold mb-4">
                <i class="fas fa-eye text-blue-500 mr-2"></i>
                æ•°æ®é¢„è§ˆ
            </h3>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                <template x-for="course in courseData.slice(0, 6)" :key="course.id">
                    <div class="border rounded-lg p-4 hover:shadow-md transition">
                        <h4 class="font-semibold" x-text="course.name"></h4>
                        <p class="text-sm text-gray-600" x-text="course.desc"></p>
                        <span class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded mt-2 inline-block">
                            <span x-text="course.chapters ? course.chapters.length : 0"></span> ç« èŠ‚
                        </span>
                    </div>
                </template>
            </div>
        </div>

        <!-- ç½‘ç»œçŠ¶æ€ -->
        <div class="mt-8 text-center">
            <div class="inline-flex items-center px-4 py-2 rounded-lg" 
                 :class="navigator.onLine ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'">
                <i :class="navigator.onLine ? 'fas fa-wifi' : 'fas fa-wifi-slash'" class="mr-2"></i>
                <span x-text="navigator.onLine ? 'ç½‘ç»œè¿æ¥æ­£å¸¸' : 'ç½‘ç»œè¿æ¥æ–­å¼€'"></span>
            </div>
        </div>
    </div>

    <script>
        function testApp() {
            return {
                cssStatus: 'æ£€æŸ¥CSSæ ·å¼æ˜¯å¦æ­£ç¡®åº”ç”¨',
                cssLoaded: true,
                jsonStatus: 'æµ‹è¯•JSONæ•°æ®åŠ è½½',
                jsonLoaded: false,
                jsStatus: 'æµ‹è¯•JavaScriptæ¨¡å—åŠ è½½',
                jsLoaded: true,
                courseData: [],

                async init() {
                    console.log('ğŸš€ å¼€å§‹æµ‹è¯•èµ„æºåŠ è½½...');
                    
                    // æ£€æŸ¥CSSæ˜¯å¦åŠ è½½
                    this.checkCSS();
                    
                    // æµ‹è¯•JSONåŠ è½½
                    await this.testJSONLoad();
                    
                    // æ£€æŸ¥JavaScriptæ¨¡å—
                    this.checkJS();
                },

                checkCSS() {
                    try {
                        // æ£€æŸ¥æ˜¯å¦æœ‰è‡ªå®šä¹‰CSSç±»
                        const testEl = document.createElement('div');
                        testEl.className = 'card-hover';
                        document.body.appendChild(testEl);
                        
                        const styles = window.getComputedStyle(testEl);
                        const hasTransition = styles.transition !== 'all 0s ease 0s';
                        
                        document.body.removeChild(testEl);
                        
                        if (hasTransition) {
                            this.cssStatus = 'CSSæ–‡ä»¶åŠ è½½æˆåŠŸï¼ŒåŠ¨ç”»æ•ˆæœæ­£å¸¸';
                            this.cssLoaded = true;
                        } else {
                            this.cssStatus = 'CSSæ–‡ä»¶å¯èƒ½æœªæ­£ç¡®åŠ è½½';
                            this.cssLoaded = false;
                        }
                    } catch (error) {
                        this.cssStatus = 'CSSæ£€æŸ¥å‡ºé”™: ' + error.message;
                        this.cssLoaded = false;
                    }
                },

                async testJSONLoad() {
                    try {
                        const loader = window.resourceLoader;
                        this.jsonStatus = 'æ­£åœ¨æµ‹è¯•å¤šç­–ç•¥åŠ è½½...';
                        
                        // æµ‹è¯•å¤šç­–ç•¥åŠ è½½
                        const data = await loader.loadJSON(
                            'bilibilicatgorybydifficulty.json', 
                            window.fallbackCourseData,
                            { useJSFallback: true }
                        );
                        
                        this.courseData = data;
                        this.jsonStatus = `å¤šç­–ç•¥åŠ è½½æˆåŠŸï¼å…± ${data.length} é—¨è¯¾ç¨‹`;
                        this.jsonLoaded = true;
                        
                        // æ˜¾ç¤ºä½¿ç”¨çš„æ•°æ®æº
                        if (window.courseDataMain && data === window.courseDataMain) {
                            this.jsonStatus += ' (æ¥æº: JavaScriptæ•°æ®æ–‡ä»¶)';
                        } else if (data === window.fallbackCourseData) {
                            this.jsonStatus += ' (æ¥æº: å¤‡ç”¨æ•°æ®)';
                        } else {
                            this.jsonStatus += ' (æ¥æº: JSONæ–‡ä»¶)';
                        }
                        
                    } catch (error) {
                        this.jsonStatus = 'JSONåŠ è½½å¤±è´¥: ' + error.message;
                        this.jsonLoaded = false;
                        
                        // æœ€åçš„å¤‡ç”¨ç­–ç•¥
                        if (window.fallbackCourseData) {
                            this.courseData = window.fallbackCourseData;
                            this.jsonStatus = 'ä½¿ç”¨æœ€ç»ˆå¤‡ç”¨æ•°æ®ï¼Œå…± ' + this.courseData.length + ' é—¨è¯¾ç¨‹';
                            this.jsonLoaded = true;
                        }
                    }
                },

                checkJS() {
                    try {
                        const checks = [];
                        
                        if (window.resourceLoader) {
                            checks.push('âœ… èµ„æºåŠ è½½å™¨');
                        } else {
                            checks.push('âŒ èµ„æºåŠ è½½å™¨');
                        }
                        
                        if (window.courseDataMain) {
                            checks.push('âœ… ä¸»æ•°æ®æ–‡ä»¶');
                        } else {
                            checks.push('âŒ ä¸»æ•°æ®æ–‡ä»¶');
                        }
                        
                        if (window.fallbackCourseData) {
                            checks.push('âœ… å¤‡ç”¨æ•°æ®');
                        } else {
                            checks.push('âŒ å¤‡ç”¨æ•°æ®');
                        }
                        
                        this.jsStatus = checks.join(' | ');
                        this.jsLoaded = !this.jsStatus.includes('âŒ');
                    } catch (error) {
                        this.jsStatus = 'JavaScriptæ£€æŸ¥å‡ºé”™: ' + error.message;
                        this.jsLoaded = false;
                    }
                },

                async testLoad() {
                    // é‡ç½®çŠ¶æ€
                    this.cssLoaded = false;
                    this.jsonLoaded = false;
                    this.jsLoaded = false;
                    this.courseData = [];
                    
                    // é‡æ–°æµ‹è¯•
                    await this.init();
                }
            }
        }
    </script>
</body>
</html>