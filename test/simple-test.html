<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–AIåŠ©æ‰‹æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
    <div class="max-w-2xl mx-auto">
        <h1 class="text-2xl font-bold mb-6">ğŸ§ª ç®€åŒ–AIåŠ©æ‰‹æµ‹è¯•</h1>
        
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <h2 class="text-lg font-semibold mb-4">æ‰‹åŠ¨åŠ è½½æ­¥éª¤</h2>
            <div class="space-y-3">
                <button onclick="step1()" class="w-full bg-blue-500 text-white p-3 rounded">
                    1ï¸âƒ£ åŠ è½½CSSæ ·å¼
                </button>
                <button onclick="step2()" class="w-full bg-green-500 text-white p-3 rounded">
                    2ï¸âƒ£ åŠ è½½è®¯é£API
                </button>
                <button onclick="step3()" class="w-full bg-purple-500 text-white p-3 rounded">
                    3ï¸âƒ£ åŠ è½½APIç®¡ç†å™¨
                </button>
                <button onclick="step4()" class="w-full bg-orange-500 text-white p-3 rounded">
                    4ï¸âƒ£ åŠ è½½æ‚¬æµ®çª—
                </button>
                <button onclick="step5()" class="w-full bg-red-500 text-white p-3 rounded">
                    5ï¸âƒ£ åˆå§‹åŒ–å¹¶æ˜¾ç¤º
                </button>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow p-6">
            <h2 class="text-lg font-semibold mb-4">çŠ¶æ€æ˜¾ç¤º</h2>
            <div id="status" class="bg-gray-100 p-4 rounded font-mono text-sm whitespace-pre-wrap"></div>
        </div>
    </div>

    <script>
        function updateStatus(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.textContent += `[${timestamp}] ${message}\n`;
        }

        async function step1() {
            updateStatus('åŠ è½½CSSæ ·å¼...');
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = '../assets/css/ai-assistant-float.css';
            link.onload = () => updateStatus('âœ… CSSåŠ è½½æˆåŠŸ');
            link.onerror = () => updateStatus('âŒ CSSåŠ è½½å¤±è´¥');
            document.head.appendChild(link);
        }

        async function step2() {
            updateStatus('åŠ è½½è®¯é£API...');
            try {
                await loadScript('../assets/js/xunfei-spark-api.js');
                updateStatus('âœ… è®¯é£APIåŠ è½½æˆåŠŸ');
            } catch (error) {
                updateStatus('âŒ è®¯é£APIåŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function step3() {
            updateStatus('åŠ è½½APIç®¡ç†å™¨...');
            try {
                await loadScript('../assets/js/ai-api-manager.js');
                updateStatus('âœ… APIç®¡ç†å™¨åŠ è½½æˆåŠŸ');
            } catch (error) {
                updateStatus('âŒ APIç®¡ç†å™¨åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function step4() {
            updateStatus('åŠ è½½æ‚¬æµ®çª—...');
            try {
                await loadScript('../assets/js/ai-assistant-float.js');
                updateStatus('âœ… æ‚¬æµ®çª—åŠ è½½æˆåŠŸ');
            } catch (error) {
                updateStatus('âŒ æ‚¬æµ®çª—åŠ è½½å¤±è´¥: ' + error.message);
            }
        }

        async function step5() {
            updateStatus('åˆå§‹åŒ–AIåŠ©æ‰‹...');
            try {
                // åˆå§‹åŒ–APIç®¡ç†å™¨
                if (!window.aiAPIManager && window.AIAPIManager) {
                    window.aiAPIManager = new AIAPIManager();
                    updateStatus('âœ… APIç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
                }

                // åˆå§‹åŒ–AIåŠ©æ‰‹
                if (!window.aiAssistant && window.AIAssistantFloat) {
                    window.aiAssistant = new AIAssistantFloat();
                    updateStatus('âœ… AIåŠ©æ‰‹åˆå§‹åŒ–å®Œæˆ');
                    
                    // ç­‰å¾…ä¸€ä¼šå„¿å†æ˜¾ç¤º
                    setTimeout(() => {
                        if (window.aiAssistant.show) {
                            window.aiAssistant.show();
                            updateStatus('âœ… AIåŠ©æ‰‹çª—å£å·²æ˜¾ç¤º');
                        } else {
                            updateStatus('âŒ AIåŠ©æ‰‹showæ–¹æ³•ä¸å­˜åœ¨');
                        }
                    }, 1000);
                } else {
                    updateStatus('âŒ AIåŠ©æ‰‹ç±»ä¸å¯ç”¨');
                }

                // æ·»åŠ è§¦å‘æŒ‰é’®
                addTriggerButton();
                
            } catch (error) {
                updateStatus('âŒ åˆå§‹åŒ–å¤±è´¥: ' + error.message);
            }
        }

        function addTriggerButton() {
            if (document.getElementById('manual-trigger')) return;
            
            const button = document.createElement('button');
            button.id = 'manual-trigger';
            button.innerHTML = 'ğŸ¤–';
            button.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                font-size: 24px;
                cursor: pointer;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            
            button.addEventListener('click', function() {
                updateStatus('æ‰‹åŠ¨è§¦å‘æŒ‰é’®è¢«ç‚¹å‡»');
                if (window.aiAssistant) {
                    try {
                        window.aiAssistant.show();
                        updateStatus('âœ… AIåŠ©æ‰‹å·²æ˜¾ç¤º');
                    } catch (error) {
                        updateStatus('âŒ æ˜¾ç¤ºå¤±è´¥: ' + error.message);
                    }
                } else {
                    updateStatus('âŒ AIåŠ©æ‰‹æœªåˆå§‹åŒ–');
                }
            });
            
            document.body.appendChild(button);
            updateStatus('âœ… æ‰‹åŠ¨è§¦å‘æŒ‰é’®å·²æ·»åŠ ');
        }

        function loadScript(src) {
            return new Promise((resolve, reject) => {
                if (document.querySelector(`script[src="${src}"]`)) {
                    resolve();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }

        // æ•è·é”™è¯¯
        window.addEventListener('error', function(event) {
            updateStatus('âŒ å…¨å±€é”™è¯¯: ' + (event.error?.message || event.message));
        });

        updateStatus('é¡µé¢åŠ è½½å®Œæˆï¼Œè¯·ä¾æ¬¡ç‚¹å‡»æŒ‰é’®è¿›è¡Œæµ‹è¯•');
    </script>
</body>
</html>