<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¤ç‰ˆAIåŠ©æ‰‹æµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ç›´æ¥åŠ è½½æ‰€æœ‰å¿…è¦è„šæœ¬ -->
    <script src="../assets/js/xunfei-spark-api.js"></script>
    <script src="../assets/js/ai-api-manager.js"></script>
    <script src="../assets/js/ai-assistant-float.js"></script>
    <link href="../assets/css/ai-assistant-float.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg p-8 max-w-md w-full">
        <h1 class="text-2xl font-bold text-center mb-6">ğŸ”§ ä¿®å¤ç‰ˆAIåŠ©æ‰‹</h1>
        
        <div class="space-y-4">
            <button onclick="initAI()" 
                    class="w-full bg-blue-500 text-white py-3 rounded hover:bg-blue-600">
                ğŸš€ æ‰‹åŠ¨åˆå§‹åŒ–AIåŠ©æ‰‹
            </button>
            
            <button onclick="showAI()" 
                    class="w-full bg-green-500 text-white py-3 rounded hover:bg-green-600">
                ğŸ‘ï¸ æ˜¾ç¤ºAIåŠ©æ‰‹
            </button>
            
            <button onclick="checkStatus()" 
                    class="w-full bg-purple-500 text-white py-3 rounded hover:bg-purple-600">
                ğŸ” æ£€æŸ¥çŠ¶æ€
            </button>
        </div>
        
        <div id="status" class="mt-6 p-4 bg-gray-100 rounded text-sm font-mono whitespace-pre-wrap max-h-40 overflow-y-auto">
            ç­‰å¾…æ“ä½œ...
        </div>
    </div>

    <script>
        function log(message) {
            const status = document.getElementById('status');
            const timestamp = new Date().toLocaleTimeString();
            status.textContent += `[${timestamp}] ${message}\n`;
            status.scrollTop = status.scrollHeight;
            console.log(message);
        }

        function initAI() {
            log('ğŸš€ å¼€å§‹åˆå§‹åŒ–AIåŠ©æ‰‹...');
            
            try {
                // æ£€æŸ¥ç±»æ˜¯å¦å¯ç”¨
                log(`ç±»æ£€æŸ¥: XunfeiSparkAPI=${!!window.XunfeiSparkAPI}, AIAPIManager=${!!window.AIAPIManager}, AIAssistantFloat=${!!window.AIAssistantFloat}`);
                
                // åˆå§‹åŒ–APIç®¡ç†å™¨
                if (!window.aiAPIManager && window.AIAPIManager) {
                    window.aiAPIManager = new AIAPIManager();
                    log('âœ… APIç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ');
                } else {
                    log('âš ï¸ APIç®¡ç†å™¨å·²å­˜åœ¨æˆ–ç±»ä¸å¯ç”¨');
                }
                
                // åˆå§‹åŒ–AIåŠ©æ‰‹
                if (!window.aiAssistant && window.AIAssistantFloat) {
                    window.aiAssistant = new AIAssistantFloat();
                    log('âœ… AIåŠ©æ‰‹åˆå§‹åŒ–å®Œæˆ');
                    
                    // éªŒè¯æ–¹æ³•
                    if (typeof window.aiAssistant.show === 'function') {
                        log('âœ… showæ–¹æ³•å¯ç”¨');
                    } else {
                        log('âŒ showæ–¹æ³•ä¸å¯ç”¨');
                    }
                } else if (window.aiAssistant) {
                    log('âš ï¸ AIåŠ©æ‰‹å·²å­˜åœ¨');
                } else {
                    log('âŒ AIAssistantFloatç±»ä¸å¯ç”¨');
                }
                
                // æ·»åŠ è§¦å‘æŒ‰é’®
                addFixedTriggerButton();
                
            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                console.error('åˆå§‹åŒ–é”™è¯¯:', error);
            }
        }

        function showAI() {
            log('ğŸ‘ï¸ å°è¯•æ˜¾ç¤ºAIåŠ©æ‰‹...');
            
            if (window.aiAssistant && typeof window.aiAssistant.show === 'function') {
                try {
                    window.aiAssistant.show();
                    log('âœ… AIåŠ©æ‰‹å·²æ˜¾ç¤º');
                } catch (error) {
                    log(`âŒ æ˜¾ç¤ºå¤±è´¥: ${error.message}`);
                }
            } else {
                log('âŒ AIåŠ©æ‰‹æœªåˆå§‹åŒ–æˆ–æ–¹æ³•ä¸å¯ç”¨');
                
                // å°è¯•é‡æ–°åˆå§‹åŒ–
                if (window.AIAssistantFloat) {
                    try {
                        window.aiAssistant = new AIAssistantFloat();
                        window.aiAssistant.show();
                        log('âœ… é‡æ–°åˆå§‹åŒ–å¹¶æ˜¾ç¤ºæˆåŠŸ');
                    } catch (error) {
                        log(`âŒ é‡æ–°åˆå§‹åŒ–å¤±è´¥: ${error.message}`);
                    }
                }
            }
        }

        function checkStatus() {
            log('ğŸ” æ£€æŸ¥å½“å‰çŠ¶æ€...');
            log(`window.aiAssistant: ${!!window.aiAssistant}`);
            log(`window.aiAPIManager: ${!!window.aiAPIManager}`);
            log(`window.AIAssistantFloat: ${!!window.AIAssistantFloat}`);
            log(`window.XunfeiSparkAPI: ${!!window.XunfeiSparkAPI}`);
            log(`window.AIAPIManager: ${!!window.AIAPIManager}`);
            
            if (window.aiAssistant) {
                log(`AIåŠ©æ‰‹ç±»å‹: ${window.aiAssistant.constructor.name}`);
                log(`showæ–¹æ³•: ${typeof window.aiAssistant.show}`);
                log(`isVisible: ${window.aiAssistant.isVisible}`);
                log(`isMinimized: ${window.aiAssistant.isMinimized}`);
            }
            
            // æ£€æŸ¥DOMå…ƒç´ 
            const elements = ['ai-assistant-float', 'ai-float-window', 'ai-float-bubble'];
            elements.forEach(id => {
                const el = document.getElementById(id);
                log(`DOM ${id}: ${!!el} ${el ? `(${el.style.display || 'default'})` : ''}`);
            });
        }

        function addFixedTriggerButton() {
            // ç§»é™¤ç°æœ‰æŒ‰é’®
            const existing = document.getElementById('fixed-ai-trigger');
            if (existing) existing.remove();
            
            const button = document.createElement('button');
            button.id = 'fixed-ai-trigger';
            button.innerHTML = 'ğŸ¤–';
            button.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                font-size: 24px;
                cursor: pointer;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            
            button.onclick = function() {
                log('ğŸ–±ï¸ å›ºå®šæŒ‰é’®è¢«ç‚¹å‡»');
                showAI();
            };
            
            document.body.appendChild(button);
            log('âœ… å›ºå®šè§¦å‘æŒ‰é’®å·²æ·»åŠ ');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œè‡ªåŠ¨æ£€æŸ¥çŠ¶æ€');
                checkStatus();
            }, 500);
        });

        // æ•è·æ‰€æœ‰é”™è¯¯
        window.addEventListener('error', function(event) {
            log(`âŒ å…¨å±€é”™è¯¯: ${event.error?.message || event.message}`);
        });
    </script>
</body>
</html>