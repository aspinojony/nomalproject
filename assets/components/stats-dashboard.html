<!-- Â≠¶‰π†ÁªüËÆ°ÁªÑ‰ª∂ -->
<div class="stats-dashboard" x-data="statsDashboard()">
        <!-- Â≠¶‰π†ÁªüËÆ°ÂºπÁ™ó -->
        <div x-show="showStatsModal" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            
            <div class="bg-white dark:bg-gray-800 rounded-2xl max-w-6xl w-full max-h-[90vh] overflow-y-auto shadow-2xl"
                 x-transition:enter="transition ease-out duration-300 delay-150"
                 x-transition:enter-start="opacity-0 scale-90"
                 x-transition:enter-end="opacity-100 scale-100">
                
                <!-- Ê†áÈ¢òÊ†è -->
                <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white p-6 rounded-t-2xl">
                    <div class="flex items-center justify-between">
                        <div>
                            <h2 class="text-2xl font-bold flex items-center">
                                <i class="fas fa-chart-line mr-3"></i>
                                Â≠¶‰π†ÁªüËÆ°ÂàÜÊûê
                            </h2>
                            <p class="text-indigo-100 mt-1">Êï∞ÊçÆÈ©±Âä®ÁöÑÂ≠¶‰π†ËøõÊ≠•</p>
                        </div>
                        <button @click="closeStatsModal()" 
                                class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                </div>

                <!-- ‰∏ªË¶ÅÁªüËÆ°Âç°Áâá -->
                <div class="p-6">
                    <!-- ÊÄªËßàÁªüËÆ° -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-clock text-2xl opacity-80"></i>
                                <span class="text-xs bg-white/20 px-2 py-1 rounded-full">‰ªäÊó•</span>
                            </div>
                            <div class="text-2xl font-bold" x-text="formatTime(todayStats.studyTime)">0h 0m</div>
                            <div class="text-sm opacity-90">Â≠¶‰π†Êó∂Èïø</div>
                            <div class="mt-2 bg-white/20 rounded-full h-2">
                                <div class="bg-white rounded-full h-2 transition-all duration-500" 
                                     :style="`width: ${Math.min(100, (todayStats.studyTime / 120) * 100)}%`"></div>
                            </div>
                        </div>

                        <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-fire text-2xl opacity-80"></i>
                                <span class="text-xs bg-white/20 px-2 py-1 rounded-full">ËøûÁª≠</span>
                            </div>
                            <div class="text-2xl font-bold" x-text="stats.streakDays || 0">0</div>
                            <div class="text-sm opacity-90">ËøûÁª≠Â§©Êï∞</div>
                            <div class="text-xs mt-1 opacity-75">ÊúÄÈ´ò <span x-text="stats.maxStreakDays || 0">0</span> Â§©</div>
                        </div>

                        <div class="bg-gradient-to-br from-purple-500 to-purple-600 text-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-brain text-2xl opacity-80"></i>
                                <span class="text-xs bg-white/20 px-2 py-1 rounded-full">ÊÄªËÆ°</span>
                            </div>
                            <div class="text-2xl font-bold" x-text="stats.totalQuestionsAnswered || 0">0</div>
                            <div class="text-sm opacity-90">Â∑≤Á≠îÈ¢òÁõÆ</div>
                            <div class="text-xs mt-1 opacity-75">Ê≠£Á°ÆÁéá <span x-text="accuracy + '%'">0%</span></div>
                        </div>

                        <div class="bg-gradient-to-br from-orange-500 to-orange-600 text-white p-6 rounded-xl shadow-lg">
                            <div class="flex items-center justify-between mb-2">
                                <i class="fas fa-trophy text-2xl opacity-80"></i>
                                <span class="text-xs bg-white/20 px-2 py-1 rounded-full">Á¥ØËÆ°</span>
                            </div>
                            <div class="text-2xl font-bold" x-text="formatTotalTime(stats.totalStudyTime)">0h</div>
                            <div class="text-sm opacity-90">ÊÄªÂ≠¶‰π†Êó∂Èïø</div>
                            <div class="text-xs mt-1 opacity-75">ÂÖ± <span x-text="stats.totalSessions || 0">0</span> Ê¨°‰ºöËØù</div>
                        </div>
                    </div>

                    <!-- ËØ¶ÁªÜÁªüËÆ°Èù¢Êùø -->
                    <div class="grid lg:grid-cols-3 gap-6 mb-6">
                        <!-- ‰ªäÊó•Â≠¶‰π†ËØ¶ÊÉÖ -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center text-gray-800 dark:text-white">
                                <i class="fas fa-calendar-day text-blue-500 mr-2"></i>
                                ‰ªäÊó•Â≠¶‰π†Ê¶ÇÂÜµ
                            </h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 dark:text-gray-300">Â≠¶‰π†Êó∂Èïø</span>
                                    <span class="font-semibold text-blue-600" x-text="formatTime(todayStats.studyTime)">0ÂàÜÈíü</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 dark:text-gray-300">Â≠¶‰π†‰ºöËØù</span>
                                    <span class="font-semibold text-green-600" x-text="todayStats.sessions + ' Ê¨°'">0Ê¨°</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 dark:text-gray-300">Á≠îÈ¢òÊï∞Èáè</span>
                                    <span class="font-semibold text-purple-600" x-text="todayStats.questionsAnswered + ' È¢ò'">0È¢ò</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600 dark:text-gray-300">Ê≠£Á°ÆÁéá</span>
                                    <span class="font-semibold text-orange-600" 
                                          x-text="(todayStats.questionsAnswered > 0 ? Math.round((todayStats.correctAnswers / todayStats.questionsAnswered) * 100) : 0) + '%'">0%</span>
                                </div>
                            </div>

                            <!-- ÁõÆÊ†áËøõÂ∫¶ -->
                            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-600">
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600 dark:text-gray-300">‰ªäÊó•ÁõÆÊ†áÂÆåÊàêÂ∫¶</span>
                                    <span class="text-sm font-medium" x-text="Math.min(100, Math.round((todayStats.studyTime / 120) * 100)) + '%'">0%</span>
                                </div>
                                <div class="bg-gray-200 dark:bg-gray-600 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-blue-500 to-purple-500 rounded-full h-3 transition-all duration-500" 
                                         :style="`width: ${Math.min(100, Math.round((todayStats.studyTime / 120) * 100))}%`"></div>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    ÁõÆÊ†á: 2Â∞èÊó∂/Â§©
                                </div>
                            </div>
                        </div>

                        <!-- ÁßëÁõÆÂàÜÂ∏É -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center text-gray-800 dark:text-white">
                                <i class="fas fa-chart-pie text-purple-500 mr-2"></i>
                                ÁßëÁõÆÂ≠¶‰π†ÂàÜÂ∏É
                            </h3>
                            <div class="space-y-3">
                                <template x-for="subject in subjectsRanking.slice(0, 5)" :key="subject.key">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center flex-1">
                                            <div class="w-3 h-3 rounded-full mr-3" 
                                                 :class="getSubjectColor(subject.key)"></div>
                                            <span class="text-sm text-gray-700 dark:text-gray-300 flex-1" x-text="subject.name">ÁßëÁõÆ</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-semibold text-gray-800 dark:text-white" x-text="formatTime(subject.time)">0ÂàÜÈíü</div>
                                            <div class="text-xs text-gray-500" x-text="subject.questions + 'È¢ò'">0È¢ò</div>
                                        </div>
                                    </div>
                                </template>
                            </div>

                            <!-- ÁßëÁõÆÂ≠¶‰π†Êó∂ÈïøÂç†ÊØî -->
                            <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-600">
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">Â≠¶‰π†Êó∂ÈïøÂàÜÂ∏É</div>
                                <div class="flex rounded-full h-2 bg-gray-200 dark:bg-gray-600 overflow-hidden">
                                    <template x-for="subject in subjectsRanking.slice(0, 4)" :key="subject.key">
                                        <div :class="getSubjectColor(subject.key)" 
                                             :style="`width: ${(subject.time / Math.max(1, stats.totalStudyTime)) * 100}%`"></div>
                                    </template>
                                </div>
                            </div>
                        </div>

                        <!-- Â≠¶‰π†ÊàêÂ∞± -->
                        <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6">
                            <h3 class="text-lg font-semibold mb-4 flex items-center text-gray-800 dark:text-white">
                                <i class="fas fa-medal text-yellow-500 mr-2"></i>
                                Â≠¶‰π†ÊàêÂ∞±
                            </h3>
                            <div class="grid grid-cols-2 gap-3">
                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                    <i class="fas fa-fire text-2xl text-orange-500 mb-2"></i>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ËøûÁª≠Â≠¶‰π†</div>
                                    <div class="text-sm font-bold text-gray-800 dark:text-white" x-text="stats.streakDays + ' Â§©'">0Â§©</div>
                                </div>
                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                    <i class="fas fa-clock text-2xl text-blue-500 mb-2"></i>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">ÊÄªÊó∂Èïø</div>
                                    <div class="text-sm font-bold text-gray-800 dark:text-white" x-text="Math.round((stats.totalStudyTime || 0) / 60) + 'h'">0h</div>
                                </div>
                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                    <i class="fas fa-brain text-2xl text-purple-500 mb-2"></i>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Á≠îÈ¢òÊï∞</div>
                                    <div class="text-sm font-bold text-gray-800 dark:text-white" x-text="(stats.totalQuestionsAnswered || 0) + ' È¢ò'">0È¢ò</div>
                                </div>
                                <div class="text-center p-3 bg-white dark:bg-gray-800 rounded-lg">
                                    <i class="fas fa-target text-2xl text-green-500 mb-2"></i>
                                    <div class="text-xs text-gray-600 dark:text-gray-400">Ê≠£Á°ÆÁéá</div>
                                    <div class="text-sm font-bold text-gray-800 dark:text-white" x-text="accuracy + '%'">0%</div>
                                </div>
                            </div>

                            <!-- ÊàêÂ∞±ÂæΩÁ´† -->
                            <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-600">
                                <div class="text-sm text-gray-600 dark:text-gray-300 mb-2">Ëé∑ÂæóÂæΩÁ´†</div>
                                <div class="flex flex-wrap gap-2">
                                    <div x-show="stats.streakDays >= 7" 
                                         class="flex items-center text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full">
                                        <i class="fas fa-fire mr-1"></i>
                                        ÂùöÊåÅ‰∏ÄÂë®
                                    </div>
                                    <div x-show="(stats.totalStudyTime || 0) >= 6000" 
                                         class="flex items-center text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                                        <i class="fas fa-clock mr-1"></i>
                                        ÁôæÂ∞èÊó∂Â≠¶ËÄÖ
                                    </div>
                                    <div x-show="accuracy >= 90 && (stats.totalQuestionsAnswered || 0) >= 100" 
                                         class="flex items-center text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">
                                        <i class="fas fa-bullseye mr-1"></i>
                                        Á≤æÂáÜÁ≠îÈ¢ò
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Âë®Â≠¶‰π†Ë∂ãÂäøÂõæ -->
                    <div class="bg-gray-50 dark:bg-gray-700 rounded-xl p-6 mb-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center text-gray-800 dark:text-white">
                            <i class="fas fa-chart-bar text-green-500 mr-2"></i>
                            Êú¨Âë®Â≠¶‰π†Ë∂ãÂäø
                        </h3>
                        <div class="grid grid-cols-7 gap-2 h-32">
                            <template x-for="day in weeklyData" :key="day.date">
                                <div class="flex flex-col items-center">
                                    <div class="flex-1 flex items-end w-full">
                                        <div class="w-full bg-gradient-to-t from-blue-500 to-blue-300 rounded-t-md transition-all duration-500 hover:from-blue-600 hover:to-blue-400" 
                                             :style="`height: ${Math.max(8, (day.studyTime / Math.max(1, Math.max(...weeklyData.map(d => d.studyTime)))) * 100)}%`"
                                             :title="`${day.dayName}: ${formatTime(day.studyTime)}`"></div>
                                    </div>
                                    <div class="text-xs text-gray-600 dark:text-gray-400 mt-1" x-text="day.dayName">Âë®‰∏Ä</div>
                                    <div class="text-xs font-medium text-gray-800 dark:text-white" x-text="day.studyTime + 'm'">0m</div>
                                </div>
                            </template>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-400 text-center mt-2">
                            Êú¨Âë®ÊÄªËÆ°Ôºö<span x-text="formatTime(weeklyData.reduce((sum, day) => sum + day.studyTime, 0))" class="font-medium">0ÂàÜÈíü</span>
                        </div>
                    </div>

                    <!-- Êìç‰ΩúÊåâÈíÆÂå∫ -->
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button @click="exportStats()" 
                                class="flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-download mr-2"></i>
                            ÂØºÂá∫Êï∞ÊçÆ
                        </button>
                        <button @click="showGoalSettings = true" 
                                class="flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-target mr-2"></i>
                            ËÆæÁΩÆÁõÆÊ†á
                        </button>
                        <button @click="showResetConfirm = true" 
                                class="flex items-center px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-trash mr-2"></i>
                            ÈáçÁΩÆÊï∞ÊçÆ
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÁõÆÊ†áËÆæÁΩÆÂºπÁ™ó -->
        <div x-show="showGoalSettings" 
             class="fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4">
            <div class="bg-white dark:bg-gray-800 rounded-xl max-w-md w-full p-6">
                <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-white">ËÆæÁΩÆÂ≠¶‰π†ÁõÆÊ†á</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ÊØèÊó•Â≠¶‰π†Êó∂Èïø (ÂàÜÈíü)</label>
                        <input type="number" x-model="newGoals.dailyStudyTime" min="30" max="480" 
                               class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ÁõÆÊ†áÊ≠£Á°ÆÁéá (%)</label>
                        <input type="number" x-model="newGoals.targetAccuracy" min="60" max="100" 
                               class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-800 dark:text-white">
                    </div>
                </div>
                <div class="flex gap-3 mt-6">
                    <button @click="showGoalSettings = false" 
                            class="flex-1 bg-gray-500 text-white py-2 rounded-lg hover:bg-gray-600 transition-colors">
                        ÂèñÊ∂à
                    </button>
                    <button @click="saveGoals()" 
                            class="flex-1 bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition-colors">
                        ‰øùÂ≠ò
                    </button>
                </div>
            </div>
        </div>
    </div>

<!-- Â≠¶‰π†ÁªüËÆ°ÁªÑ‰ª∂ËÑöÊú¨ -->
<script>
function statsDashboard() {
    return {
        showStatsModal: false,
        showGoalSettings: false,
        stats: {},
        todayStats: {},
        weeklyData: [],
        subjectsRanking: [],
        accuracy: 0,
        newGoals: {
            dailyStudyTime: 120,
            targetAccuracy: 85
        },

        init() {
            this.loadStatsData();
            // ÁõëÂê¨ÁªüËÆ°Êï∞ÊçÆÊõ¥Êñ∞
            if (window.studyStats) {
                window.studyStats.addObserver((event, data) => {
                    if (event === 'statsUpdated') {
                        this.loadStatsData();
                    }
                });
            }
        },

        loadStatsData() {
            if (window.studyStats) {
                this.stats = window.studyStats.stats;
                this.todayStats = window.studyStats.getTodayStats();
                this.subjectsRanking = window.studyStats.getSubjectsRanking();
                this.accuracy = window.studyStats.getAccuracy();
                this.loadWeeklyData();
                this.newGoals = { ...this.stats.goals };
            }
        },

        loadWeeklyData() {
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            this.weeklyData = [];
            for (let i = 0; i < 7; i++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                const dayStats = this.stats.dailyStats?.[dateStr] || { studyTime: 0 };
                
                this.weeklyData.push({
                    date: dateStr,
                    dayName: date.toLocaleDateString('zh-CN', { weekday: 'short' }),
                    studyTime: dayStats.studyTime || 0
                });
            }
        },

        openStatsModal() {
            this.showStatsModal = true;
            this.loadStatsData();
        },

        closeStatsModal() {
            this.showStatsModal = false;
        },

        formatTime(minutes) {
            if (!minutes || minutes === 0) return '0ÂàÜÈíü';
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            if (hours > 0) {
                return mins > 0 ? `${hours}h ${mins}m` : `${hours}h`;
            }
            return `${mins}m`;
        },

        formatTotalTime(minutes) {
            if (!minutes || minutes === 0) return '0h';
            const hours = Math.floor(minutes / 60);
            return `${hours}h`;
        },

        getSubjectColor(subjectKey) {
            const colors = {
                'mathematics': 'bg-blue-500',
                'english': 'bg-green-500',
                'politics': 'bg-red-500',
                'data_structure': 'bg-purple-500',
                'operating_system': 'bg-orange-500',
                'computer_network': 'bg-teal-500',
                'computer_organization': 'bg-indigo-500'
            };
            return colors[subjectKey] || 'bg-gray-500';
        },

        exportStats() {
            if (window.studyStats) {
                const data = window.studyStats.exportData();
                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json'
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `study-stats-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.showNotification('üìä ÁªüËÆ°Êï∞ÊçÆÂ∑≤ÂØºÂá∫', 'success');
            }
        },

        saveGoals() {
            if (window.studyStats) {
                window.studyStats.setGoals(this.newGoals);
                this.showGoalSettings = false;
                this.loadStatsData();
                this.showNotification('üéØ Â≠¶‰π†ÁõÆÊ†áÂ∑≤Êõ¥Êñ∞', 'success');
            }
        },

        showNotification(message, type = 'info') {
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                warning: 'bg-yellow-500',
                info: 'bg-blue-500'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-x-full transition-all duration-300`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
    };
}

// ÂÖ®Â±ÄÂáΩÊï∞Ôºå‰æõÂ§ñÈÉ®Ë∞ÉÁî®
window.openStatsModal = function() {
    const dashboard = document.querySelector('[x-data*="statsDashboard"]');
    if (dashboard) {
        Alpine.evaluate(dashboard, 'openStatsModal()');
    }
};

console.log('üìä Â≠¶‰π†ÁªüËÆ°ÂèØËßÜÂåñÁªÑ‰ª∂Âä†ËΩΩÂÆåÊàê');
</script>